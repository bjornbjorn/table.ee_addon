{"version":3,"file":"table.min.js","sources":["../../../../system/expressionengine/third_party/table/js/table.js"],"names":["Table","$","sr","debounce","func","threshold","execAsap","timeout","delayed","apply","obj","args","this","arguments","clearTimeout","setTimeout","jQuery","fn","bind","trigger","field_id","current_table","closest","num","arr","counter","each","Math","abs","position","updateFieldContainerWidth","width","addRowActions","row_num","append","cell_height","addColActions","col_num","cell_width","addTransitionsClass","addClass","getTableHeight","num_rows","getTableWidth","num_cols","getAssetsImgThumb","file_id","thumb_url","Assets","siteUrl","actions","view_thumbnail","random","updateTitleImageCellData","row","col","cell_data_name","cell_ref","undefined","hidden_input","find","attr","assets_file_id","data","title_text","val","JSON","stringify","updateTableCells","tabindex","current_cell","rowtype","cell_inited","text_value","cell_content","getNewTextCellContent","html","current_cell_first_child","children","first","init_cell_value","title_image_cell_content","getNewTitleImageCellContent","getTable","getTableLeftBar","getTableCells","getTableCol","getTableRow","getTableRowDragger","getTableColDragger","getTableRowDeleteLink","getTableColDeleteLink","updateTableRow","move_index","new_row_num","current_row","current_drag_row","current_row_delete_link","row_position","row_positions","css","updateTableCol","new_col_num","current_col","current_drag_col","current_col_delete_link","col_position","col_positions","updateRowPositionsCache","i","push","updateColPositionCache","addNewTableRow","row_type","new_row_position","dragging","drag_row","drag_col","last_drag_x","last_drag_y","height","x","y","console","log","on","e","preventDefault","stopPropagation","dropdown","is","hide","show","document","add_image_controls_div","parent","thumb_image_div","remove_image_controls_div","assets_sheet","Sheet","multiSelect","filedirs","kinds","onSelect","files","length","id","img_tag","fadeIn","alert","new_col_position","the_table_row","the_table_row_dragger","the_table_row_delete_link","confirm","remove","removeClass","the_table_col","the_table_col_dragger","the_table_col_delete_link","drag_element","fadeOut","not","pageY","offset","top","drag_link","closest_row","new_row_index","should_move_row","should_move_row_to_y","should_move_row_down","should_move_row_down_to_y","pageX","left","drag_col_link","closest_col","new_col_index","should_move_over_col_to_x","should_move_over_col_right_to","row_y","row_counter","row_x","col_counter","window","smartresize"],"mappings":"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","sourcesContent":["    var Table;\n\n\n    /**\n     * smart resize function\n     *\n     */\n    (function($,sr){\n\n        // debouncing function from John Hann\n        // http://unscriptable.com/index.php/2009/03/20/debouncing-javascript-methods/\n        var debounce = function (func, threshold, execAsap) {\n            var timeout;\n\n            return function debounced () {\n                var obj = this, args = arguments;\n                function delayed () {\n                    if (!execAsap)\n                        func.apply(obj, args);\n                    timeout = null;\n                }\n\n                if (timeout)\n                    clearTimeout(timeout);\n                else if (execAsap)\n                    func.apply(obj, args);\n\n                timeout = setTimeout(delayed, threshold || 100);\n            };\n        };\n        // smartresize\n        jQuery.fn[sr] = function(fn){  return fn ? this.bind('resize', debounce(fn)) : this.trigger(sr); };\n\n    })(jQuery,'smartresize');\n\n\n\n    (function($){\n\n        Table = function(field_id) {\n\n            var obj = $(this);\n            var current_table = $('#table__table__'+field_id);\n\n            /**\n             * Find the closest number in an array to the number provided\n             *\n             * @param num number to find closest to\n             * @param arr array of numbers\n             * @return object with \"position\" (array index) and \"closest\" (number) (ie. position: 1, closest: 100)\n             */\n            obj.closest = function(num, arr) {\n                var closest = null;\n                var counter = -1;\n\n                $.each(arr, function() {\n                    if (closest === null || Math.abs(this - num) < Math.abs(closest - num)) {\n                        closest = this;\n                        counter++;\n                    }\n                });\n\n                return {position: counter, closest: closest};\n            };\n\n\n            obj.updateFieldContainerWidth = function() {\n                $('.table__table__container').width(\n                    $('#publish').width() - 36\n                );\n            };\n\n\n            /**\n             * Add a row reoder \"flip\" to the table + delete icon\n             * @param row\n             */\n            obj.addRowActions = function(row_num) {\n                current_table.append('<div class=\"drag-row icon-reorder\" style=\"top:'+((row_num-1) * cell_height)+'px\" data-row=\"'+row_num+'\"></div>');\n                current_table.append('<div class=\"table__table__delete-row icon-remove-circle\" style=\"top: '+((row_num*cell_height)-(cell_height/2)-5)+'px\" data-row=\"'+row_num+'\"></div>');\n            };\n\n            /**\n             * Add a column reoder \"flip\" to the table\n             * @param col_num\n             */\n            obj.addColActions = function(col_num) {\n                current_table.append('<div class=\"drag-col icon-reorder\" style=\"left:'+((col_num*cell_width)-19)+'px\" data-col=\"'+col_num+'\"></div>');\n                current_table.append('<div class=\"table__table__delete-col icon-remove-circle\" style=\"left: ' + (((col_num*cell_width) - (cell_width/2) - 8 )  +'px\" data-col=\"'+col_num+'\"></div>'));\n            };\n\n\n            /**\n             * Add 'transitions' class to elements that should have it after init\n             */\n            obj.addTransitionsClass = function() {\n                $('#table__table__'+field_id+' .table__cell').addClass('transitions');\n            };\n\n            /**\n             * Get the current suggested table height (w/o header)\n             */\n            obj.getTableHeight = function() {\n                return num_rows * cell_height;\n            };\n\n            obj.getTableWidth = function() {\n                return num_cols * cell_width;\n            };\n\n            obj.getAssetsImgThumb = function(file_id) {\n                var thumb_url = Assets.siteUrl + '?ACT=' + Assets.actions.view_thumbnail+'&file_id='+file_id+'&size=100x100&hash='+Math.random();\n                return '<img data-assets_file_id=\"'+file_id+'\" src=\"'+thumb_url+'\"/>';\n            };\n\n\n            /**\n             * Update the cell content data for a Title/Image cell\n             *\n             * @param row\n             * @param col\n             */\n            obj.updateTitleImageCellData = function(row, col, cell_data_name, cell_ref) {\n\n                if(cell_data_name === undefined) {\n                    cell_data_name = 'table_cell_'+field_id+'['+row+']['+col+']';\n                }\n                if(typeof cell_ref == \"undefined\") {\n                    cell_ref = $('#table__table__'+field_id+' .table__cell[data-row=\"'+row+'\"][data-col=\"'+col+'\"]');\n                }\n\n                var hidden_input = cell_ref.find('input[type=hidden]');\n                hidden_input.attr('name', cell_data_name);\n\n                // update the value of the hidden with the current values of the content\n                var assets_file_id = cell_ref.find('img').data('assets_file_id');\n                var title_text = cell_ref.find('input[type=text]').val();\n\n                hidden_input.val( JSON.stringify( {assets_file_id: assets_file_id, title_text: title_text} ));\n\n            };\n\n            /**\n             * Update all table cells w/correct tabindex etc. - this is needed after\n             * dragging around rows/cols and adding/removing rows/cols\n             */\n            obj.updateTableCells = function() {\n\n                /**\n                 * Update table cell tabs indexes\n                 */\n                var tabindex = 0;\n                for(var row=1; row < (num_rows+1); row++) {\n                    for(var col=1; col < (num_cols+1); col++) {\n                        tabindex++;\n                        var current_cell = $('#table__table__'+field_id+' .table__cell[data-row=\"'+row+'\"][data-col=\"'+col+'\"]');\n                        var rowtype = current_cell.data('row-type');\n                        var cell_data_name = 'table_cell_'+field_id+'['+row+']['+col+']['+rowtype+']';\n                        var cell_inited = current_cell.data('inited') !== 0;\n\n                        switch(rowtype) {\n                            case 'text':\n\n                                if(!cell_inited) {\n\n                                    var text_value = current_cell.data('init-cell-value');\n                                    var cell_content = obj.getNewTextCellContent(row, col, text_value);\n                                    current_cell.attr('inited', 1);\n                                    current_cell.data('inited', 1);\n                                    current_cell.html(cell_content);\n                                }\n\n                                var current_cell_first_child =  current_cell.children().first();\n                                current_cell_first_child.attr('tabindex', tabindex);\n                                current_cell_first_child.attr('name', cell_data_name);\n                                break;\n\n                            case 'title_image':\n\n                                if(!cell_inited) {\n\n                                    var init_cell_value = current_cell.data('init-cell-value');\n\n                                    var title_image_cell_content = obj.getNewTitleImageCellContent(row, col, init_cell_value.assets_file_id, init_cell_value.title_text);\n                                    current_cell.attr('inited', 1);\n                                    current_cell.data('inited', 1);\n                                    current_cell.html(title_image_cell_content);\n                                }\n\n                                obj.updateTitleImageCellData(row, col, cell_data_name, current_cell);\n                                break;\n                        }\n\n\n                    }\n                }\n            };\n\n            /**\n             * Get the table\n             *\n             * @returns {*|jQuery|HTMLElement}\n             */\n            obj.getTable = function() {\n                return $('#table__table__'+field_id);\n            };\n\n            obj.getTableLeftBar = function() {\n                return $('#table__table__'+field_id+' .table__table__left__bar');\n            };\n\n            /**\n             * Get all table cells\n             *\n             * @returns {*|jQuery|HTMLElement}\n             */\n            obj.getTableCells = function() {\n                return $('#table__table__'+field_id+' .table__cell');\n            };\n\n            /**\n             * Get column by column number\n             *\n             * @param col_num\n             */\n            obj.getTableCol = function(col_num) {\n                return $('#table__table__'+field_id+' .table__cell[data-col='+col_num+']');\n            };\n\n            /**\n             * Get row by row number\n             *\n             * @param row_num\n             */\n            obj.getTableRow = function(row_num) {\n                return $('#table__table__'+field_id+' .table__cell[data-row=\"'+(row_num)+'\"]');\n            };\n\n            /**\n             * Get a specific row dragger by row number, or all row draggers if row_num not specified\n             *\n             * @param row_num (can be empty)\n             */\n            obj.getTableRowDragger = function(row_num) {\n                if(row_num !== undefined) {\n                    return $('#table__table__'+field_id+' .drag-row[data-row=\"'+row_num+'\"]');\n                } else {\n                    return $('#table__table__'+field_id+' .drag-row');\n                }\n            };\n\n            /**\n             * Get col dragger by column number, or all column draggers if col_num not specified\n             *\n             * @param col_num (can be empty)\n             */\n            obj.getTableColDragger = function(col_num) {\n                if(col_num !== undefined) {\n                    return $('#table__table__'+field_id+' .drag-col[data-col=\"'+col_num+'\"]');\n                } else {\n                    return $('#table__table__'+field_id+' .drag-col');\n                }\n            };\n\n\n            /**\n             * Get row delete link by row number, or all if row number not defined\n             *\n             * @param row_num\n             * @returns {*|jQuery|HTMLElement}\n             */\n            obj.getTableRowDeleteLink = function(row_num) {\n                if(row_num !== undefined) {\n                    return $('#table__table__'+field_id+' .table__table__delete-row[data-row=\"'+row_num+'\"]');\n                } else {\n                    return $('#table__table__'+field_id+' .table__table__delete-row');\n                }\n            };\n\n            /**\n             * Get col delete link by col number, or all if col number not defined\n             *\n             * @param col_num\n             * @returns {*|jQuery|HTMLElement}\n             */\n            obj.getTableColDeleteLink = function(col_num) {\n                if(col_num !== undefined) {\n                    return $('#table__table__'+field_id+' .table__table__delete-col[data-col=\"'+col_num+'\"]');\n                } else {\n                    return $('#table__table__'+field_id+' .table__table__delete-col');\n                }\n            };\n\n\n            /**\n             * Will update a table row and its action icons to the correct postions\n             * @param row_num the row number\n             * @param move_index change the row number of this row (ie. -1 will move the row one up)\n             */\n            obj.updateTableRow = function(row_num, move_index) {\n\n                var new_row_num = row_num;\n                var current_row = obj.getTableRow(row_num);\n                var current_drag_row = obj.getTableRowDragger(row_num);\n                var current_row_delete_link = obj.getTableRowDeleteLink(row_num);\n\n                if(move_index !== undefined) {\n                    new_row_num = row_num + move_index;\n                    current_row.data('row', new_row_num);\n                    current_row.attr('data-row', new_row_num);\n                    current_drag_row.data('row', new_row_num);\n                    current_drag_row.attr('data-row', new_row_num);\n                    current_row_delete_link.data('row', new_row_num);\n                    current_row_delete_link.attr('data-row', new_row_num);\n                }\n\n                var row_position = row_positions[new_row_num-1];\n                current_drag_row.css('top', row_position + 'px' );\n                current_row.css('top', row_position + 'px' );\n\n                current_row_delete_link.css('top', (row_position + (cell_height/2)-5) + 'px');\n            };\n\n\n            /**\n             * Will update a table column and its action icons to the correct positions\n             *\n             * @param col_num the column number\n             * @param move_index change the col number of this column (ie. -1 will move the col to the left)\n             */\n            obj.updateTableCol = function(col_num, move_index) {\n\n                var new_col_num = col_num;\n                var current_col = obj.getTableCol(col_num);\n                var current_drag_col = obj.getTableColDragger(col_num);\n                var current_col_delete_link = obj.getTableColDeleteLink(col_num);\n\n                if(move_index !== undefined) {\n                    new_col_num = col_num + move_index;\n                    current_col.data('col', new_col_num);\n                    current_col.attr('data-col', new_col_num);\n                    current_drag_col.data('col', new_col_num);\n                    current_drag_col.attr('data-col', new_col_num);\n                    current_col_delete_link.data('col', new_col_num);\n                    current_col_delete_link.attr('data-col', new_col_num);\n                }\n\n                var col_position = col_positions[new_col_num-1];\n                current_col.css('left', col_position + 'px');\n                current_drag_col.css('left', (col_position - 19) + 'px');\n                current_col_delete_link.css('left', col_position + ((cell_width/2)-8) +'px');\n\n            };\n\n\n            /**\n             * Update row positions array\n             */\n            obj.updateRowPositionsCache = function() {\n                row_positions = [];\n                for(var i=0; i < num_rows; i++) {\n                    var row_position = i*cell_height;\n                    row_positions.push( row_position );\n                }\n            };\n\n\n            /**\n             *  Update col position array\n             */\n            obj.updateColPositionCache = function() {\n                col_positions = [];\n                for(var i=0; i < num_cols; i++) {\n                    var col_position = i*cell_width;\n                    col_positions.push( col_position );\n                }\n            };\n\n            /**\n             * Get HTML for a text cell\n             *\n             * @param row_num\n             * @param col_num\n             * @returns {string}\n             */\n            obj.getNewTextCellContent = function(row_num, col_num, text_value) {\n\n                if(text_value !== undefined) {\n                    return '<textarea>'+text_value+'</textarea>';\n                }\n                else {\n                    return '<textarea></textarea>';\n                }\n            };\n\n            /**\n             * Get HTML for a title image cell\n             *\n             * @param row_num\n             * @param col_num\n             * @returns {string}\n             */\n            obj.getNewTitleImageCellContent = function(row_num, col_num, assets_file_id, title_text) {\n\n                var html = '<input type=\"hidden\"><input type=\"text\" value=\"'+(title_text !== undefined ? title_text : '')+'\">';\n\n                if(assets_file_id === undefined) {\n                    html += '<div class=\"table__table__cell-add-image-controls\"><a href=\"#\" class=\"table__table__cell__add-image-button\" data-field_id=\"'+field_id+'\">Add image</a></div><div class=\"table__table__cell-remove-image-controls\" style=\"display:none\"><div class=\"table__table__cell-thumbnail\"></div><a href=\"#\" class=\"table__table__cell__remove-image-button\" data-field_id=\"'+field_id+'\">Remove image</a></div>';\n                } else {\n                    html += '<div class=\"table__table__cell-add-image-controls\" style=\"display:none\"><a href=\"#\" class=\"table__table__cell__add-image-button\" data-field_id=\"'+field_id+'\">Add image</a></div><div class=\"table__table__cell-remove-image-controls\"><div class=\"table__table__cell-thumbnail\">'+ obj.getAssetsImgThumb(assets_file_id) +'</div><a href=\"#\" class=\"table__table__cell__remove-image-button\" data-field_id=\"'+field_id+'\">Remove image</a></div>';\n                }\n\n                return html;\n            };\n\n\n            /**\n             * Add a standard Text row to the table\n             */\n            obj.addNewTableRow = function(row_type) {\n\n                if(row_type === undefined) {\n                    row_type = 'text';\n                }\n\n                current_table.css('height', obj.getTableHeight() + cell_height);\n                var new_row_num = num_rows+1;\n                var new_row_position = (num_rows*cell_height);\n\n                obj.addRowActions(new_row_num);\n\n                /**\n                 * If we are adding the first row, and we don't have any cols yet, add a single col\n                 */\n                if(num_cols === 0) {\n                    num_cols = 1;\n                    obj.addColActions(1);\n                    col_positions = [0];\n                }\n\n                for(var i=0; i < num_cols; i++ ) {\n                    var new_col_num = i+1;\n                    var cell_content = '';\n                    switch(row_type) {\n                        case 'title_image':\n                            cell_content = obj.getNewTitleImageCellContent(new_row_num, new_col_num);\n                            break;\n                        case 'text':\n                            cell_content = obj.getNewTextCellContent(new_row_num, new_col_num);\n                            break;\n                    }\n\n                    current_table.append(\n                        '<div style=\"top:'+new_row_position+'px; left:'+(i*cell_width)+'px\" class=\"table__cell transitions\" data-row-type=\"'+row_type+'\" data-row=\"'+new_row_num+'\" data-col=\"'+new_col_num+'\">'+cell_content+'</div>'\n                    );\n                }\n\n                row_positions.push(new_row_position);\n                num_rows++;\n\n                obj.getTableLeftBar().css('height', (obj.getTableHeight() + 20) + 'px' );\n\n                obj.updateTableCells();\n            };\n\n\n            var cell_width = 200;\n            var cell_height = 150;\n            var num_cols = current_table.data('init-num-cols');\n            var num_rows = current_table.data('init-num-rows');\n            var row_positions = [0];\n            var col_positions = [];\n\n            var dragging = false;       // is currently dragging? true/false\n            var drag_row = false;       // row number being dragged\n            var drag_col = false;       // col number being dragged\n            var last_drag_x = false;    // last X position used for row when dragging\n            var last_drag_y = false;    // last Y position used for col when dragging\n\n            /**\n             * Initiate the table. Will move cells around to their correct\n             * initial positions.\n             *\n             */\n            current_table.height(obj.getTableHeight());\n            if(num_cols > 0) {\n                current_table.width(obj.getTableWidth());\n            }\n\n            var x = 0;\n            var y = 0;\n\n            if(num_rows > 0) {\n                obj.addRowActions(1); // add for 1st\n            }\n\n            obj.getTableCells().each(function(e) {\n                if(x >= num_cols) {\n                    x = 0;\n                    y++;\n\n                    obj.addRowActions(y+1);\n\n                    row_positions.push(y*cell_height);\n                }\n                $(this).css('left', x*cell_width);\n                $(this).css('top', y*cell_height);\n\n                if(y === 0) {\n                    col_positions.push(x*cell_width);            // as long as we are on first row, store col positions\n                    obj.addColActions(x+1);\n                    console.log(\"adding col actions\");\n                }\n\n                x++;\n            });\n\n            obj.getTableLeftBar().css('height', ((num_rows*cell_height) + 20) + 'px' );\n\n            obj.updateTableCells();\n\n\n            // add transitions class after we have positioned them\n            setTimeout(obj.addTransitionsClass, 500);\n\n\n            /**\n             * Global click handler\n             */\n          /*  $(document).on('click', function(e) {\n        */\n                /**\n                 * If the add row dropdown is displaying hide it\n                 */\n          /*      if($('.table__table__add-row-dropdown').is(':visible')) {\n                    $('.table__table__add-row-dropdown').hide();\n                }\n            });\n\n        */\n\n            /**\n             * Add row button click handler\n             */\n            $('.table__table__add-row[data-field_id='+field_id+']').on('click', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n\n                var dropdown = $('.table__table__add-row-dropdown[data-field_id='+field_id+']');\n\n                if(dropdown.is(':visible')) {\n                    dropdown.hide();\n                } else {\n                    dropdown.show();\n                }\n            });\n\n\n            $('.table__table__add-row-dropdown[data-field_id='+field_id+'] .table__table__add-text-row').on('click', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n                $('.table__table__add-row-dropdown[data-field_id='+field_id+']').hide();\n\n                obj.addNewTableRow();\n            });\n\n            $('.table__table__add-row-dropdown[data-field_id='+field_id+'] .table__table__add-title-image-row').on('click', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n                $('.table__table__add-row-dropdown[data-field_id='+field_id+']').hide();\n\n                obj.addNewTableRow('title_image');\n            });\n\n            $(document).on('click', '.table__table__cell__add-image-button[data-field_id='+field_id+']', function(e) {\n                e.preventDefault();\n\n                var add_image_controls_div = $(this).parent();\n                var thumb_image_div = add_image_controls_div.parent().find('.table__table__cell-thumbnail');\n                var remove_image_controls_div = add_image_controls_div.parent().find('.table__table__cell-remove-image-controls');\n                var assets_sheet = new Assets.Sheet({\n\n                    // optional settings (these are the default values):\n                    multiSelect: false,\n                    filedirs:    'all', // or array of filedir IDs\n                    kinds:       ['image'], // or array of file kinds (\"image\", \"flash\", etc)\n\n                    // onSelect callback (required):\n                    onSelect:    function(files) {\n\n                        if(files.length > 0) {\n                            add_image_controls_div.hide();\n                            var file_id = files[0].id;\n                            var img_tag = obj.getAssetsImgThumb(file_id);\n                            thumb_image_div.html(img_tag);\n                            remove_image_controls_div.fadeIn();\n                        }\n                    }\n                });\n\n                assets_sheet.show();\n            });\n\n\n            $(document).on('click', '.table__table__cell__remove-image-button[data-field_id='+field_id+']', function(e) {\n                e.preventDefault();\n                var remove_image_controls_div = $(this).parent();\n                var add_image_controls_div = remove_image_controls_div.parent().find('.table__table__cell-add-image-controls');\n                var thumb_image_div = remove_image_controls_div.find('.table__table__cell-thumbnail');\n                thumb_image_div.html('');\n                remove_image_controls_div.hide();\n                add_image_controls_div.fadeIn();\n\n            });\n\n\n            /**\n             * Add col button click handler\n             */\n            $('.table__table__add-col[data-field_id='+field_id+']').on('click', function(e) {\n                e.preventDefault();\n\n                if(num_rows === 0) {\n                    alert(\"Add a row first\");\n                    return;\n                }\n\n                $('#table__table__'+field_id+' .table__table__add-row-dropdown[data-field_id='+field_id+']').hide();    // just in case it is showing\n\n                current_table.css('width', obj.getTableWidth() + cell_width);\n                var new_col_num = num_cols+1;\n                var new_col_position = (num_cols*cell_width);\n\n                obj.addColActions(new_col_num);\n                for(var i=0; i < num_rows; i++) {\n                    var new_row_num = i+1;\n\n                    // find the row type based on the first column\n                    var row_type = $('#table__table__'+field_id+' .table__cell[data-row=\"'+new_row_num+'\"][data-col=1]').data('row-type');\n                    var cell_content = '';\n                    switch(row_type) {\n                        case 'title_image':\n                            cell_content = obj.getNewTitleImageCellContent(new_row_num, new_col_num);\n                            break;\n                        case 'text':\n                            cell_content = obj.getNewTextCellContent(new_row_num, new_col_num);\n                            break;\n                    }\n                    current_table.append(\n                        '<div style=\"top:'+(i*cell_height)+'px; left:'+new_col_position+'px\" class=\"table__cell transitions\" data-row-type=\"'+row_type+'\" data-row=\"'+new_row_num+'\" data-col=\"'+new_col_num+'\">'+cell_content+'</div>'\n                    );\n                }\n\n                col_positions.push(new_col_position);\n                num_cols++;\n\n                obj.updateTableCells();\n            });\n\n\n            /**\n             * Delete row button click handler\n             */\n            $(document).on('click','#table__table__'+field_id+' .table__table__delete-row', function(e) {\n                var row = $(this).data('row');\n                var the_table_row = obj.getTableRow(row);\n                var the_table_row_dragger = obj.getTableRowDragger(row);\n                var the_table_row_delete_link = obj.getTableRowDeleteLink(row);\n\n                the_table_row.addClass('table__cell-pending-delete');\n                if(confirm('Sure you want to delete the row?')) {\n\n                    // remove the row + elements\n                    the_table_row.remove();\n                    the_table_row_dragger.remove();\n                    the_table_row_delete_link.remove();\n\n                    num_rows--;\n                    current_table.css('height', cell_height*num_rows);\n                    obj.updateRowPositionsCache();\n\n                    // move all rows below the deleted row one up\n                    for(var i=row; i <= num_rows; i++) {\n                        obj.updateTableRow(i+1, -1);\n                    }\n\n                    obj.getTableLeftBar().css('height', (obj.getTableHeight() + 20) + 'px' );\n\n                    obj.updateTableCells();\n\n                } else {\n                    the_table_row.removeClass('table__cell-pending-delete');\n                }\n            });\n\n\n            $(document).on('click', '#table__table__'+field_id+' .table__table__delete-col', function(e) {\n\n                var col = $(this).data('col');\n                var the_table_col = obj.getTableCol(col);\n                var the_table_col_dragger = obj.getTableColDragger(col);\n                var the_table_col_delete_link = obj.getTableColDeleteLink(col);\n\n                the_table_col.addClass('table__cell-pending-delete');\n                if(confirm('Sure you want to delete the column?')) {\n\n                    the_table_col.remove();\n                    the_table_col_dragger.remove();\n                    the_table_col_delete_link.remove();\n\n                    num_cols --;\n                    current_table.css('width', cell_width*num_cols);\n                    obj.updateColPositionCache();\n\n                    for(var i=col; i <= num_cols; i++) {\n                        obj.updateTableCol(i+1, -1);\n                    }\n\n                } else {\n                    the_table_col.removeClass('table__cell-pending-delete');\n                }\n            });\n\n\n            /**\n             * drag-row mouse handler\n             */\n            $(document).on('mousedown', '#table__table__'+field_id+' .drag-row', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n\n                $(this).addClass('active__dragging__link');\n                var row = $(this).data('row');\n                var drag_element = obj.getTableRow(row);\n                drag_element.removeClass('transitions').addClass('table__dragging__element');\n\n                obj.getTableRowDeleteLink().fadeOut();\n\n                $('#table__table__'+field_id+' .drag-row').not('.active__dragging__link').fadeOut(400, function(e) {\n                    if(!dragging) {\n                        $(this).show(); // if dragging completed before the fadeout completes then we need to show() it again here since the .show() in the mouseup event won't do its job as it is called before fadeOut() completes.\n                    }\n                });\n\n                dragging = true;\n                drag_row = row;\n                drag_col = false;\n                return false;\n            });\n\n\n            /**\n             * drag-col mouse handler\n             */\n            $(document).on('mousedown', '#table__table__'+field_id+' .drag-col', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n\n                $(this).addClass('active__dragging__link');\n                obj.getTableColDeleteLink().fadeOut();\n\n                var col = $(this).data('col');\n\n\n                obj.getTableCol(col).removeClass('transitions').addClass('table__dragging__element');\n\n                $('#table__table__'+field_id+' .drag-col').not('.active__dragging__link').fadeOut(400, function(e) {\n                    if(!dragging) {\n                        $(this).show(); // if dragging completed before the fadeout completes then we need to show() it again here since the .show() in the mouseup event won't do its job as it is called before fadeOut() completes.\n                    }\n                });\n\n                dragging = true;\n                drag_col = col;\n                drag_row = false;\n\n                return false;\n            });\n\n            $(document).on('mousemove', function(e) {\n                e.preventDefault();\n\n                if(dragging) {\n\n                    if(drag_row) {\n                        last_drag_y = e.pageY - current_table.offset().top;\n\n                        var drag_link = $('.drag-row.active__dragging__link');\n\n                        /**\n                         * Move the row being dragged\n                         */\n                        drag_link.css('top', last_drag_y+'px');\n                        drag_link.css('left', '-20px');\n                        drag_link.css('position', 'absolute');\n\n                        $('#table__table__'+field_id+' .table__dragging__element').each(function(e) {\n                            $(this).css('top', last_drag_y + 'px');\n                        });\n\n                        var closest_row = obj.closest(last_drag_y, row_positions);\n                        var new_row_index = closest_row.position+1;\n\n                        /**\n                         * We are moving down, so move the one beneath up\n                         */\n                        if((closest_row.position+1) > drag_row) {\n\n                            var should_move_row = closest_row.position+1;\n                            var should_move_row_to_y = closest_row.closest - cell_height;\n\n                            obj.getTableRow(should_move_row).each(function(e) {\n                                $(this).css('top', (should_move_row_to_y) + 'px');\n                                $(this).attr('data-row', should_move_row-1);\n                                $(this).data('row', should_move_row-1);\n                            });\n\n                            /**\n                             * Update row information for the row we are currently dragging\n                             */\n                            $('#table__table__'+field_id+' .table__dragging__element').each(function(e) {\n                                $(this).attr('data-row', new_row_index+1);\n                                $(this).data('row', new_row_index+1);\n                            });\n\n                            drag_row = new_row_index+1;\n\n\n                        } else if((closest_row.position+1) < drag_row) {\n\n                            var should_move_row_down = closest_row.position+1;\n                            var should_move_row_down_to_y = should_move_row_down*cell_height;\n\n                            obj.getTableRow(should_move_row_down).each(function(e) {\n                                $(this).css('top', (should_move_row_down_to_y) + 'px');\n                                $(this).attr('data-row', should_move_row_down+1);\n                                $(this).data('row', should_move_row_down+1);\n                            });\n\n                            /**\n                             * Update row information for the row being dragged\n                             */\n\n                            $('#table__table__'+field_id+' .table__dragging__element').each(function(e) {\n                                $(this).attr('data-row', new_row_index);\n                                $(this).data('row', new_row_index);\n                            });\n\n                            drag_row = new_row_index;\n                        }\n\n                    } else if(drag_col) {\n\n                        last_drag_x = e.pageX - current_table.offset().left - cell_width;\n\n                        var drag_col_link = $('.drag-col.active__dragging__link');\n\n                        /**\n                         * Move the row being dragged\n                         */\n                        drag_col_link.css('top', '-20px');\n                        drag_col_link.css('left', (last_drag_x+cell_width-19)+'px');\n                        drag_col_link.css('position', 'absolute');\n\n                        /**\n                         * Move the column being dragged\n                         */\n                        $('#table__table__'+field_id+' .table__dragging__element').each(function(e) {\n                            $(this).css('left', last_drag_x + 'px');\n                        });\n\n                        var closest_col = obj.closest(last_drag_x, col_positions);\n                        var new_col_index = closest_col.position+1;\n\n                        if(new_col_index > drag_col) {\n\n                            var should_move_over_col_to_x = (closest_col.position-1) * cell_width;\n\n                            /**\n                             * Move the col we are over left\n                             */\n                            obj.getTableCol(new_col_index).each(function(e) {\n                                $(this).css('left', (should_move_over_col_to_x) + 'px');\n                                $(this).attr('data-col', new_col_index-1);\n                                $(this).data('col', new_col_index-1);\n                            });\n\n                            $('#table__table__'+field_id+' .table__dragging__element').each(function(e) {\n                                $(this).attr('data-col', new_col_index);\n                                $(this).data('col', new_col_index);\n                            });\n\n                            drag_col = new_col_index;\n\n\n                        } else if(new_col_index < drag_col) {\n\n                            var should_move_over_col_right_to =  (closest_col.position+1) * cell_width;\n\n                            /**\n                             * Move the col we are over right\n                             */\n                            obj.getTableCol(new_col_index).each(function(e) {\n                                $(this).css('left', (should_move_over_col_right_to) + 'px');\n                                $(this).attr('data-col', new_col_index+1);\n                                $(this).data('col', new_col_index+1);\n                            });\n\n                            $('#table__table__'+field_id+' .table__dragging__element').each(function(e) {\n                                $(this).attr('data-col', new_col_index);\n                                $(this).data('col', new_col_index);\n                            });\n\n                            drag_col = new_col_index;\n\n                        }\n                    }\n                }\n\n                return false;\n            });\n\n            $(document).on('mouseup', function(e) {\n                e.preventDefault();\n                dragging = false;\n\n                $('.active__dragging__link').removeClass('active__dragging__link');\n\n                if(drag_row) {  // we were dragging a row, so find the closest spot for it\n\n                    obj.getTableRowDeleteLink().fadeIn();\n\n                    var closest_row = obj.closest(last_drag_y, row_positions);\n                    var row_y = closest_row.closest;\n                    $('.table__dragging__element').css('top', row_y+'px');\n\n                    /**\n                     * Go through all drag rows and position them correctly + set data-row based on position in HTML\n                     */\n                    var row_counter = 1;\n                    obj.getTableRowDragger().each(function(e) {\n                        $(this).css('top', ((row_counter-1) * cell_height) + 'px' );\n                        $(this).attr('data-row', row_counter);\n                        $(this).data('row', row_counter);\n                        row_counter++;\n\n                        $(this).show();\n                    });\n\n\n                } else if(drag_col) {\n\n                    obj.getTableColDeleteLink().fadeIn();\n\n                    var closest_col = obj.closest(last_drag_x, col_positions);\n                    var row_x = closest_col.closest;\n                    $('.table__dragging__element').css('left', row_x+'px');\n\n                    var col_counter = 1;\n                    obj.getTableColDragger().each(function(e) {\n                        $(this).css('left', ((col_counter * cell_width)-19) + 'px' );\n                        $(this).attr('data-col', col_counter);\n                        $(this).data('col', col_counter);\n                        col_counter++;\n\n                        $(this).show();\n                    });\n\n                }\n\n                obj.getTableCells().removeClass('table__dragging__element').addClass('transitions');\n\n                obj.updateTableCells();\n\n                drag_row = false;\n                drag_col = false;\n\n                return false;\n            });\n\n\n            obj.updateFieldContainerWidth();\n            $(window).smartresize(obj.updateFieldContainerWidth);\n\n        };\n\n    })(jQuery);"]}