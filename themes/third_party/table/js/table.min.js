var Table;!function(a,b){var c=function(a,b,c){var d;return function(){function e(){c||a.apply(f,g),d=null}var f=this,g=arguments;d?clearTimeout(d):c&&a.apply(f,g),d=setTimeout(e,b||100)}};jQuery.fn[b]=function(a){return a?this.bind("resize",c(a)):this.trigger(b)}}(jQuery,"smartresize"),function(a){Table=function(b){var c=a(this),d=a("#table__table__"+b);c.closest=function(b,c){var d=null,e=-1;return a.each(c,function(){(null===d||Math.abs(this-b)<Math.abs(d-b))&&(d=this,e++)}),{position:e,closest:d}},c.updateFieldContainerWidth=function(){a(".table__table__container").width(a("#publish").width()-36)},c.addRowActions=function(a){d.append('<div class="drag-row icon-reorder" style="top:'+(a-1)*f+'px" data-row="'+a+'"></div>'),d.append('<div class="table__table__delete-row icon-remove-circle" style="top: '+(a*f-f/2-5)+'px" data-row="'+a+'"></div>')},c.addColActions=function(a){d.append('<div class="drag-col icon-reorder" style="left:'+(a*e-19)+'px" data-col="'+a+'"></div>'),d.append('<div class="table__table__delete-col icon-remove-circle" style="left: '+(a*e-e/2-8+'px" data-col="'+a+'"></div>'))},c.addTransitionsClass=function(){a("#table__table__"+b+" .table__cell").addClass("transitions")},c.getTableHeight=function(){return h*f},c.getTableWidth=function(){return g*e},c.getAssetsImgThumb=function(a){var b=Assets.siteUrl+"?ACT="+Assets.actions.view_thumbnail+"&file_id="+a+"&size=100x100&hash="+Math.random();return'<img data-assets_file_id="'+a+'" src="'+b+'"/>'},c.updateTitleImageCellData=function(c,d,e,f){void 0===e&&(e="table_cell_"+b+"["+c+"]["+d+"]"),"undefined"==typeof f&&(f=a("#table__table__"+b+' .table__cell[data-row="'+c+'"][data-col="'+d+'"]'));var g=f.find("input[type=hidden]");g.attr("name",e);var h=f.find("img").data("assets_file_id"),i=f.find("input[type=text]").val();g.val(JSON.stringify({assets_file_id:h,title_text:i}))},c.updateTableCells=function(){for(var d=0,e=1;h+1>e;e++)for(var f=1;g+1>f;f++){d++;var i=a("#table__table__"+b+' .table__cell[data-row="'+e+'"][data-col="'+f+'"]'),j=i.data("row-type"),k="table_cell_"+b+"["+e+"]["+f+"]["+j+"]",l=0!==i.data("inited");switch(j){case"text":if(!l){var m=i.data("init-cell-value"),n=c.getNewTextCellContent(e,f,m);i.attr("inited",1),i.data("inited",1),i.html(n)}var o=i.children().first();o.attr("tabindex",d),o.attr("name",k);break;case"title_image":if(!l){var p=i.data("init-cell-value"),q=c.getNewTitleImageCellContent(e,f,p.assets_file_id,p.title_text);i.attr("inited",1),i.data("inited",1),i.html(q)}c.updateTitleImageCellData(e,f,k,i)}}},c.getTable=function(){return a("#table__table__"+b)},c.getTableLeftBar=function(){return a("#table__table__"+b+" .table__table__left__bar")},c.getTableCells=function(){return a("#table__table__"+b+" .table__cell")},c.getTableCol=function(c){return a("#table__table__"+b+" .table__cell[data-col="+c+"]")},c.getTableRow=function(c){return a("#table__table__"+b+' .table__cell[data-row="'+c+'"]')},c.getTableRowDragger=function(c){return a(void 0!==c?"#table__table__"+b+' .drag-row[data-row="'+c+'"]':"#table__table__"+b+" .drag-row")},c.getTableColDragger=function(c){return a(void 0!==c?"#table__table__"+b+' .drag-col[data-col="'+c+'"]':"#table__table__"+b+" .drag-col")},c.getTableRowDeleteLink=function(c){return a(void 0!==c?"#table__table__"+b+' .table__table__delete-row[data-row="'+c+'"]':"#table__table__"+b+" .table__table__delete-row")},c.getTableColDeleteLink=function(c){return a(void 0!==c?"#table__table__"+b+' .table__table__delete-col[data-col="'+c+'"]':"#table__table__"+b+" .table__table__delete-col")},c.updateTableRow=function(a,b){var d=a,e=c.getTableRow(a),g=c.getTableRowDragger(a),h=c.getTableRowDeleteLink(a);void 0!==b&&(d=a+b,e.data("row",d),e.attr("data-row",d),g.data("row",d),g.attr("data-row",d),h.data("row",d),h.attr("data-row",d));var j=i[d-1];g.css("top",j+"px"),e.css("top",j+"px"),h.css("top",j+f/2-5+"px")},c.updateTableCol=function(a,b){var d=a,f=c.getTableCol(a),g=c.getTableColDragger(a),h=c.getTableColDeleteLink(a);void 0!==b&&(d=a+b,f.data("col",d),f.attr("data-col",d),g.data("col",d),g.attr("data-col",d),h.data("col",d),h.attr("data-col",d));var i=j[d-1];f.css("left",i+"px"),g.css("left",i-19+"px"),h.css("left",i+(e/2-8)+"px")},c.updateRowPositionsCache=function(){i=[];for(var a=0;h>a;a++){var b=a*f;i.push(b)}},c.updateColPositionCache=function(){j=[];for(var a=0;g>a;a++){var b=a*e;j.push(b)}},c.getNewTextCellContent=function(a,b,c){return void 0!==c?"<textarea>"+c+"</textarea>":"<textarea></textarea>"},c.getNewTitleImageCellContent=function(a,d,e,f){var g='<input type="hidden"><input type="text" value="'+(void 0!==f?f:"")+'">';return g+=void 0===e?'<div class="table__table__cell-add-image-controls"><a href="#" class="table__table__cell__add-image-button" data-field_id="'+b+'">Add image</a></div><div class="table__table__cell-remove-image-controls" style="display:none"><div class="table__table__cell-thumbnail"></div><a href="#" class="table__table__cell__remove-image-button" data-field_id="'+b+'">Remove image</a></div>':'<div class="table__table__cell-add-image-controls" style="display:none"><a href="#" class="table__table__cell__add-image-button" data-field_id="'+b+'">Add image</a></div><div class="table__table__cell-remove-image-controls"><div class="table__table__cell-thumbnail">'+c.getAssetsImgThumb(e)+'</div><a href="#" class="table__table__cell__remove-image-button" data-field_id="'+b+'">Remove image</a></div>'},c.addNewTableRow=function(a){void 0===a&&(a="text"),d.css("height",c.getTableHeight()+f);var b=h+1,k=h*f;c.addRowActions(b),0===g&&(g=1,c.addColActions(1),j=[0]);for(var l=0;g>l;l++){var m=l+1,n="";switch(a){case"title_image":n=c.getNewTitleImageCellContent(b,m);break;case"text":n=c.getNewTextCellContent(b,m)}d.append('<div style="top:'+k+"px; left:"+l*e+'px" class="table__cell transitions" data-row-type="'+a+'" data-row="'+b+'" data-col="'+m+'">'+n+"</div>")}i.push(k),h++,c.getTableLeftBar().css("height",c.getTableHeight()+20+"px"),c.updateTableCells()};var e=200,f=150,g=d.data("init-num-cols"),h=d.data("init-num-rows"),i=[0],j=[],k=!1,l=!1,m=!1,n=!1,o=!1;d.height(c.getTableHeight()),g>0&&d.width(c.getTableWidth());var p=0,q=0;h>0&&c.addRowActions(1),c.getTableCells().each(function(){p>=g&&(p=0,q++,c.addRowActions(q+1),i.push(q*f)),a(this).css("left",p*e),a(this).css("top",q*f),0===q&&(j.push(p*e),c.addColActions(p+1),console.log("adding col actions")),p++}),c.getTableLeftBar().css("height",h*f+20+"px"),c.updateTableCells(),setTimeout(c.addTransitionsClass,500),a(".table__table__add-row[data-field_id="+b+"]").on("click",function(c){c.preventDefault(),c.stopPropagation();var d=a(".table__table__add-row-dropdown[data-field_id="+b+"]");d.is(":visible")?d.hide():d.show()}),a(".table__table__add-row-dropdown[data-field_id="+b+"] .table__table__add-text-row").on("click",function(d){d.preventDefault(),d.stopPropagation(),a(".table__table__add-row-dropdown[data-field_id="+b+"]").hide(),c.addNewTableRow()}),a(".table__table__add-row-dropdown[data-field_id="+b+"] .table__table__add-title-image-row").on("click",function(d){d.preventDefault(),d.stopPropagation(),a(".table__table__add-row-dropdown[data-field_id="+b+"]").hide(),c.addNewTableRow("title_image")}),a(document).on("click",".table__table__cell__add-image-button[data-field_id="+b+"]",function(b){b.preventDefault();var d=a(this).parent(),e=d.parent().find(".table__table__cell-thumbnail"),f=d.parent().find(".table__table__cell-remove-image-controls"),g=new Assets.Sheet({multiSelect:!1,filedirs:"all",kinds:["image"],onSelect:function(a){if(a.length>0){d.hide();var b=a[0].id,g=c.getAssetsImgThumb(b);e.html(g),f.fadeIn()}}});g.show()}),a(document).on("click",".table__table__cell__remove-image-button[data-field_id="+b+"]",function(b){b.preventDefault();var c=a(this).parent(),d=c.parent().find(".table__table__cell-add-image-controls"),e=c.find(".table__table__cell-thumbnail");e.html(""),c.hide(),d.fadeIn()}),a(".table__table__add-col[data-field_id="+b+"]").on("click",function(i){if(i.preventDefault(),0===h)return void alert("Add a row first");a("#table__table__"+b+" .table__table__add-row-dropdown[data-field_id="+b+"]").hide(),d.css("width",c.getTableWidth()+e);var k=g+1,l=g*e;c.addColActions(k);for(var m=0;h>m;m++){var n=m+1,o=a("#table__table__"+b+' .table__cell[data-row="'+n+'"][data-col=1]').data("row-type"),p="";switch(o){case"title_image":p=c.getNewTitleImageCellContent(n,k);break;case"text":p=c.getNewTextCellContent(n,k)}d.append('<div style="top:'+m*f+"px; left:"+l+'px" class="table__cell transitions" data-row-type="'+o+'" data-row="'+n+'" data-col="'+k+'">'+p+"</div>")}j.push(l),g++,c.updateTableCells()}),a(document).on("click","#table__table__"+b+" .table__table__delete-row",function(){var b=a(this).data("row"),e=c.getTableRow(b),g=c.getTableRowDragger(b),i=c.getTableRowDeleteLink(b);if(e.addClass("table__cell-pending-delete"),confirm("Sure you want to delete the row?")){e.remove(),g.remove(),i.remove(),h--,d.css("height",f*h),c.updateRowPositionsCache();for(var j=b;h>=j;j++)c.updateTableRow(j+1,-1);c.getTableLeftBar().css("height",c.getTableHeight()+20+"px"),c.updateTableCells()}else e.removeClass("table__cell-pending-delete")}),a(document).on("click","#table__table__"+b+" .table__table__delete-col",function(){var b=a(this).data("col"),f=c.getTableCol(b),h=c.getTableColDragger(b),i=c.getTableColDeleteLink(b);if(f.addClass("table__cell-pending-delete"),confirm("Sure you want to delete the column?")){f.remove(),h.remove(),i.remove(),g--,d.css("width",e*g),c.updateColPositionCache();for(var j=b;g>=j;j++)c.updateTableCol(j+1,-1)}else f.removeClass("table__cell-pending-delete")}),a(document).on("mousedown","#table__table__"+b+" .drag-row",function(d){d.preventDefault(),d.stopPropagation(),a(this).addClass("active__dragging__link");var e=a(this).data("row"),f=c.getTableRow(e);return f.removeClass("transitions").addClass("table__dragging__element"),c.getTableRowDeleteLink().fadeOut(),a("#table__table__"+b+" .drag-row").not(".active__dragging__link").fadeOut(400,function(){k||a(this).show()}),k=!0,l=e,m=!1,!1}),a(document).on("mousedown","#table__table__"+b+" .drag-col",function(d){d.preventDefault(),d.stopPropagation(),a(this).addClass("active__dragging__link"),c.getTableColDeleteLink().fadeOut();var e=a(this).data("col");return c.getTableCol(e).removeClass("transitions").addClass("table__dragging__element"),a("#table__table__"+b+" .drag-col").not(".active__dragging__link").fadeOut(400,function(){k||a(this).show()}),k=!0,m=e,l=!1,!1}),a(document).on("mousemove",function(g){if(g.preventDefault(),k)if(l){o=g.pageY-d.offset().top;var h=a(".drag-row.active__dragging__link");h.css("top",o+"px"),h.css("left","-20px"),h.css("position","absolute"),a("#table__table__"+b+" .table__dragging__element").each(function(){a(this).css("top",o+"px")});var p=c.closest(o,i),q=p.position+1;if(p.position+1>l){var r=p.position+1,s=p.closest-f;c.getTableRow(r).each(function(){a(this).css("top",s+"px"),a(this).attr("data-row",r-1),a(this).data("row",r-1)}),a("#table__table__"+b+" .table__dragging__element").each(function(){a(this).attr("data-row",q+1),a(this).data("row",q+1)}),l=q+1}else if(p.position+1<l){var t=p.position+1,u=t*f;c.getTableRow(t).each(function(){a(this).css("top",u+"px"),a(this).attr("data-row",t+1),a(this).data("row",t+1)}),a("#table__table__"+b+" .table__dragging__element").each(function(){a(this).attr("data-row",q),a(this).data("row",q)}),l=q}}else if(m){n=g.pageX-d.offset().left-e;var v=a(".drag-col.active__dragging__link");v.css("top","-20px"),v.css("left",n+e-19+"px"),v.css("position","absolute"),a("#table__table__"+b+" .table__dragging__element").each(function(){a(this).css("left",n+"px")});var w=c.closest(n,j),x=w.position+1;if(x>m){var y=(w.position-1)*e;c.getTableCol(x).each(function(){a(this).css("left",y+"px"),a(this).attr("data-col",x-1),a(this).data("col",x-1)}),a("#table__table__"+b+" .table__dragging__element").each(function(){a(this).attr("data-col",x),a(this).data("col",x)}),m=x}else if(m>x){var z=(w.position+1)*e;c.getTableCol(x).each(function(){a(this).css("left",z+"px"),a(this).attr("data-col",x+1),a(this).data("col",x+1)}),a("#table__table__"+b+" .table__dragging__element").each(function(){a(this).attr("data-col",x),a(this).data("col",x)}),m=x}}return!1}),a(document).on("mouseup",function(b){if(b.preventDefault(),k=!1,a(".active__dragging__link").removeClass("active__dragging__link"),l){c.getTableRowDeleteLink().fadeIn();var d=c.closest(o,i),g=d.closest;a(".table__dragging__element").css("top",g+"px");var h=1;c.getTableRowDragger().each(function(){a(this).css("top",(h-1)*f+"px"),a(this).attr("data-row",h),a(this).data("row",h),h++,a(this).show()})}else if(m){c.getTableColDeleteLink().fadeIn();var p=c.closest(n,j),q=p.closest;a(".table__dragging__element").css("left",q+"px");var r=1;c.getTableColDragger().each(function(){a(this).css("left",r*e-19+"px"),a(this).attr("data-col",r),a(this).data("col",r),r++,a(this).show()})}return c.getTableCells().removeClass("table__dragging__element").addClass("transitions"),c.updateTableCells(),l=!1,m=!1,!1}),c.updateFieldContainerWidth(),a(window).smartresize(c.updateFieldContainerWidth)}}(jQuery);
//# sourceMappingURL=table.min.map