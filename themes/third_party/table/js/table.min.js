var Table;!function(a,b){var c=function(a,b,c){var d;return function(){function e(){c||a.apply(f,g),d=null}var f=this,g=arguments;d?clearTimeout(d):c&&a.apply(f,g),d=setTimeout(e,b||100)}};jQuery.fn[b]=function(a){return a?this.bind("resize",c(a)):this.trigger(b)}}(jQuery,"smartresize"),function(a){Table=function(b,c,d){var e=a(this),f=a("#table__table__"+b);e.closest=function(b,c){var d=null,e=-1;return a.each(c,function(){(null===d||Math.abs(this-b)<Math.abs(d-b))&&(d=this,e++)}),{position:e,closest:d}},e.updateFieldContainerWidth=function(){a(".table__table__container").width(a("#publish").width()-36)},e.addRowActions=function(a){f.append('<div class="drag-row icon-reorder" style="top:'+(a-1)*h+'px" data-row="'+a+'"></div>'),f.append('<div class="table__table__delete-row icon-remove-circle" style="top: '+(a*h-h/2-5)+'px" data-row="'+a+'"></div>')},e.addColActions=function(a){f.append('<div class="drag-col icon-reorder" style="left:'+(a*g-19)+'px" data-col="'+a+'"></div>'),f.append('<div class="table__table__delete-col icon-remove-circle" style="left: '+(a*g-g/2-8+'px" data-col="'+a+'"></div>'))},e.addTransitionsClass=function(){a("#table__table__"+b+" .table__cell").addClass("transitions")},e.getTableHeight=function(){return j*h},e.getTableWidth=function(){return i*g},e.updateTableCells=function(){for(var e=200*c,f=e,g=1;j+1>g;g++)for(var h=1;i+1>h;h++){f++;var k=a("#table__table__"+b+' .table__cell[data-row="'+g+'"][data-col="'+h+'"]'),l=k.data("row-type"),m="table_cell_"+b+"["+g+"]["+h+"]["+l+"]",n=0!==k.data("inited");if(!n){var o=k.data("init-cell-value"),p=d.getNewCellContent(l,b,g,h,o);k.attr("inited",1),k.data("inited",1),k.html(p)}d.updateCellContent(l,g,h,f,m,k)}},e.getTable=function(){return a("#table__table__"+b)},e.getTableLeftBar=function(){return a("#table__table__"+b+" .table__table__left__bar")},e.getTableCells=function(){return a("#table__table__"+b+" .table__cell")},e.getTableCol=function(c){return a("#table__table__"+b+" .table__cell[data-col="+c+"]")},e.getTableRow=function(c){return a("#table__table__"+b+' .table__cell[data-row="'+c+'"]')},e.getTableRowDragger=function(c){return a(void 0!==c?"#table__table__"+b+' .drag-row[data-row="'+c+'"]':"#table__table__"+b+" .drag-row")},e.getTableColDragger=function(c){return a(void 0!==c?"#table__table__"+b+' .drag-col[data-col="'+c+'"]':"#table__table__"+b+" .drag-col")},e.getTableRowDeleteLink=function(c){return a(void 0!==c?"#table__table__"+b+' .table__table__delete-row[data-row="'+c+'"]':"#table__table__"+b+" .table__table__delete-row")},e.getTableColDeleteLink=function(c){return a(void 0!==c?"#table__table__"+b+' .table__table__delete-col[data-col="'+c+'"]':"#table__table__"+b+" .table__table__delete-col")},e.updateTableRow=function(a,b){var c=a,d=e.getTableRow(a),f=e.getTableRowDragger(a),g=e.getTableRowDeleteLink(a);void 0!==b&&(c=a+b,d.data("row",c),d.attr("data-row",c),f.data("row",c),f.attr("data-row",c),g.data("row",c),g.attr("data-row",c));var i=k[c-1];f.css("top",i+"px"),d.css("top",i+"px"),g.css("top",i+h/2-5+"px")},e.updateTableCol=function(a,b){var c=a,d=e.getTableCol(a),f=e.getTableColDragger(a),h=e.getTableColDeleteLink(a);void 0!==b&&(c=a+b,d.data("col",c),d.attr("data-col",c),f.data("col",c),f.attr("data-col",c),h.data("col",c),h.attr("data-col",c));var i=l[c-1];d.css("left",i+"px"),f.css("left",i-19+"px"),h.css("left",i+(g/2-8)+"px")},e.updateRowPositionsCache=function(){k=[];for(var a=0;j>a;a++){var b=a*h;k.push(b)}},e.updateColPositionCache=function(){l=[];for(var a=0;i>a;a++){var b=a*g;l.push(b)}},e.addNewTableRow=function(a){f.css("height",e.getTableHeight()+h);var c=j+1,m=j*h;e.addRowActions(c),0===i&&(i=1,e.addColActions(1),l=[0]);for(var n=0;i>n;n++){var o=n+1,p="";p=d.getNewCellContent(a,b,c,o),f.append('<div style="top:'+m+"px; left:"+n*g+'px" class="table__cell transitions" data-row-type="'+a+'" data-row="'+c+'" data-col="'+o+'">'+p+"</div>")}k.push(m),j++,e.getTableLeftBar().css("height",e.getTableHeight()+20+"px"),e.updateTableCells()};var g=200,h=150,i=f.data("init-num-cols"),j=f.data("init-num-rows"),k=[0],l=[],m=!1,n=!1,o=!1,p=!1,q=!1;f.height(e.getTableHeight()),i>0&&f.width(e.getTableWidth());var r=0,s=0;j>0&&e.addRowActions(1),e.getTableCells().each(function(){r>=i&&(r=0,s++,e.addRowActions(s+1),k.push(s*h)),a(this).css("left",r*g),a(this).css("top",s*h),0===s&&(l.push(r*g),e.addColActions(r+1)),r++}),e.getTableLeftBar().css("height",j*h+20+"px"),e.updateTableCells(),setTimeout(e.addTransitionsClass,500),a(".table__table__add-row[data-field_id="+b+"]").on("click",function(c){c.preventDefault(),c.stopPropagation();var d=a(".table__table__add-row-dropdown[data-field_id="+b+"]");0==d.length?e.addNewTableRow("text"):d.is(":visible")?d.hide():d.show()}),a(".table__table__add-row-dropdown[data-field_id="+b+"] .table__table__add-row").on("click",function(c){c.preventDefault(),c.stopPropagation();var d=a(this).data("celltype");a(".table__table__add-row-dropdown[data-field_id="+b+"]").hide(),e.addNewTableRow(d)}),a(document).on("click",".table__table__cell__add-image-button[data-field_id="+b+"]",function(b){b.preventDefault();var c=a(this).parent(),e=c.parent().find(".table__table__cell-thumbnail"),f=c.parent().find(".table__table__cell-remove-image-controls"),g=new Assets.Sheet({multiSelect:!1,filedirs:"all",kinds:["image"],onSelect:function(a){if(a.length>0){c.hide();var b=a[0].id,g=d.getAssetsImgThumb(b);e.html(g),f.fadeIn()}}});g.show()}),a(document).on("click",".table__table__cell__remove-image-button[data-field_id="+b+"]",function(b){b.preventDefault();var c=a(this).parent(),d=c.parent().find(".table__table__cell-add-image-controls"),e=c.find(".table__table__cell-thumbnail");e.html(""),c.hide(),d.fadeIn()}),a(".table__table__add-col[data-field_id="+b+"]").on("click",function(c){if(c.preventDefault(),0===j)return void alert("Add a row first");a("#table__table__"+b+" .table__table__add-row-dropdown[data-field_id="+b+"]").hide(),f.css("width",e.getTableWidth()+g);var k=i+1,m=i*g;e.addColActions(k);for(var n=0;j>n;n++){var o=n+1,p=a("#table__table__"+b+' .table__cell[data-row="'+o+'"][data-col=1]').data("row-type"),q=d.getNewCellContent(p,b,o,k);f.append('<div style="top:'+n*h+"px; left:"+m+'px" class="table__cell transitions" data-row-type="'+p+'" data-row="'+o+'" data-col="'+k+'">'+q+"</div>")}l.push(m),i++,e.updateTableCells()}),a(document).on("click","#table__table__"+b+" .table__table__delete-row",function(){var b=a(this).data("row"),c=e.getTableRow(b),d=e.getTableRowDragger(b),g=e.getTableRowDeleteLink(b);if(c.addClass("table__cell-pending-delete"),confirm("Sure you want to delete the row?")){c.remove(),d.remove(),g.remove(),j--,f.css("height",h*j),e.updateRowPositionsCache();for(var i=b;j>=i;i++)e.updateTableRow(i+1,-1);e.getTableLeftBar().css("height",e.getTableHeight()+20+"px"),e.updateTableCells()}else c.removeClass("table__cell-pending-delete")}),a(document).on("click","#table__table__"+b+" .table__table__delete-col",function(){var b=a(this).data("col"),c=e.getTableCol(b),d=e.getTableColDragger(b),h=e.getTableColDeleteLink(b);if(c.addClass("table__cell-pending-delete"),confirm("Sure you want to delete the column?")){c.remove(),d.remove(),h.remove(),i--,f.css("width",g*i),e.updateColPositionCache();for(var j=b;i>=j;j++)e.updateTableCol(j+1,-1)}else c.removeClass("table__cell-pending-delete")}),a(document).on("mousedown","#table__table__"+b+" .drag-row",function(c){c.preventDefault(),c.stopPropagation(),a(this).addClass("active__dragging__link");var d=a(this).data("row"),f=e.getTableRow(d);return f.removeClass("transitions").addClass("table__dragging__element"),e.getTableRowDeleteLink().fadeOut(),a("#table__table__"+b+" .drag-row").not(".active__dragging__link").fadeOut(400,function(){m||a(this).show()}),m=!0,n=d,o=!1,!1}),a(document).on("mousedown","#table__table__"+b+" .drag-col",function(c){c.preventDefault(),c.stopPropagation(),a(this).addClass("active__dragging__link"),e.getTableColDeleteLink().fadeOut();var d=a(this).data("col");return e.getTableCol(d).removeClass("transitions").addClass("table__dragging__element"),a("#table__table__"+b+" .drag-col").not(".active__dragging__link").fadeOut(400,function(){m||a(this).show()}),m=!0,o=d,n=!1,!1}),a(document).on("mousemove",function(c){if(c.preventDefault(),m)if(n){q=c.pageY-f.offset().top;var d=a(".drag-row.active__dragging__link");d.css("top",q+"px"),d.css("left","-20px"),d.css("position","absolute"),a("#table__table__"+b+" .table__dragging__element").each(function(){a(this).css("top",q+"px")});var i=e.closest(q,k),j=i.position+1;if(i.position+1>n){var r=i.position+1,s=i.closest-h;e.getTableRow(r).each(function(){a(this).css("top",s+"px"),a(this).attr("data-row",r-1),a(this).data("row",r-1)}),a("#table__table__"+b+" .table__dragging__element").each(function(){a(this).attr("data-row",j+1),a(this).data("row",j+1)}),n=j+1}else if(i.position+1<n){var t=i.position+1,u=t*h;e.getTableRow(t).each(function(){a(this).css("top",u+"px"),a(this).attr("data-row",t+1),a(this).data("row",t+1)}),a("#table__table__"+b+" .table__dragging__element").each(function(){a(this).attr("data-row",j),a(this).data("row",j)}),n=j}}else if(o){p=c.pageX-f.offset().left-g;var v=a(".drag-col.active__dragging__link");v.css("top","-20px"),v.css("left",p+g-19+"px"),v.css("position","absolute"),a("#table__table__"+b+" .table__dragging__element").each(function(){a(this).css("left",p+"px")});var w=e.closest(p,l),x=w.position+1;if(x>o){var y=(w.position-1)*g;e.getTableCol(x).each(function(){a(this).css("left",y+"px"),a(this).attr("data-col",x-1),a(this).data("col",x-1)}),a("#table__table__"+b+" .table__dragging__element").each(function(){a(this).attr("data-col",x),a(this).data("col",x)}),o=x}else if(o>x){var z=(w.position+1)*g;e.getTableCol(x).each(function(){a(this).css("left",z+"px"),a(this).attr("data-col",x+1),a(this).data("col",x+1)}),a("#table__table__"+b+" .table__dragging__element").each(function(){a(this).attr("data-col",x),a(this).data("col",x)}),o=x}}return!1}),a(document).on("mouseup",function(b){if(b.preventDefault(),m=!1,a(".active__dragging__link").removeClass("active__dragging__link"),n){e.getTableRowDeleteLink().fadeIn();var c=e.closest(q,k),d=c.closest;a(".table__dragging__element").css("top",d+"px");var f=1;e.getTableRowDragger().each(function(){a(this).css("top",(f-1)*h+"px"),a(this).attr("data-row",f),a(this).data("row",f),f++,a(this).show()})}else if(o){e.getTableColDeleteLink().fadeIn();var i=e.closest(p,l),j=i.closest;a(".table__dragging__element").css("left",j+"px");var r=1;e.getTableColDragger().each(function(){a(this).css("left",r*g-19+"px"),a(this).attr("data-col",r),a(this).data("col",r),r++,a(this).show()})}return e.getTableCells().removeClass("table__dragging__element").addClass("transitions"),e.updateTableCells(),n=!1,o=!1,!1}),e.updateFieldContainerWidth(),a(window).smartresize(e.updateFieldContainerWidth)}}(jQuery);
//# sourceMappingURL=table.min.map