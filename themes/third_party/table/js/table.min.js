$(document).ready(function(){$.closest=function(a,b){var c=null,d=-1;return $.each(b,function(){(null===c||Math.abs(this-a)<Math.abs(c-a))&&(c=this,d++)}),{position:d,closest:c}},$.addRowActions=function(a){$(".table__table").append('<div class="drag-row icon-reorder" style="top:'+(a-1)*c+'px" data-row="'+a+'"></div>'),$(".table__table").append('<div class="table__table__delete-row icon-remove-circle" style="top: '+(a*c-c/2-5)+'px" data-row="'+a+'"></div>')},$.addColActions=function(a){$(".table__table").append('<div class="drag-col icon-reorder" style="left:'+(a*b-19)+'px" data-col="'+a+'"></div>'),$(".table__table").append('<div class="table__table__delete-col icon-remove-circle" style="left: '+(a*b-b/2-8+'px" data-col="'+a+'"></div>'))},$.addTransitionsClass=function(){$(".table__table .table__cell").addClass("transitions")},$.getTableHeight=function(){return e*c},$.updateTableCells=function(){for(var a=$.getTable().data("field_id"),b=0,c=1;e+1>c;c++)for(var f=1;d+1>f;f++){b++;var g=$('.table__table .table__cell[data-row="'+c+'"][data-col="'+f+'"] :first-child');g.attr("tabindex",b),g.attr("name","table_cell_"+a+"["+c+"]["+f+"]")}},$.getTable=function(){return $(".table__table")},$.getTableLeftBar=function(){return $(".table__table__left__bar")},$.getTableCells=function(){return $(".table__table .table__cell")},$.getTableCol=function(a){return $(".table__table .table__cell[data-col="+a+"]")},$.getTableRow=function(a){return $('.table__table .table__cell[data-row="'+a+'"]')},$.getTableRowDragger=function(a){return $(void 0!==a?'.drag-row[data-row="'+a+'"]':".drag-row")},$.getTableColDragger=function(a){return $(void 0!==a?'.drag-col[data-col="'+a+'"]':".drag-col")},$.getTableRowDeleteLink=function(a){return $(void 0!==a?'.table__table__delete-row[data-row="'+a+'"]':".table__table__delete-row")},$.getTableColDeleteLink=function(a){return $(void 0!==a?'.table__table__delete-col[data-col="'+a+'"]':".table__table__delete-col")},$.updateTableRow=function(a,b){var d=a,e=$.getTableRow(a),g=$.getTableRowDragger(a),h=$.getTableRowDeleteLink(a);void 0!==b&&(d=a+b,e.data("row",d),e.attr("data-row",d),g.data("row",d),g.attr("data-row",d),h.data("row",d),h.attr("data-row",d));var i=f[d-1];g.css("top",i+"px"),e.css("top",i+"px"),h.css("top",i+c/2-5+"px")},$.updateTableCol=function(a,c){var d=a,e=$.getTableCol(a),f=$.getTableColDragger(a),h=$.getTableColDeleteLink(a);void 0!==c&&(d=a+c,e.data("col",d),e.attr("data-col",d),f.data("col",d),f.attr("data-col",d),h.data("col",d),h.attr("data-col",d));var i=g[d-1];e.css("left",i+"px"),f.css("left",i-19+"px"),h.css("left",i+(b/2-8)+"px")},$.updateRowPositionsCache=function(){f=[];for(var a=0;e>a;a++){var b=a*c;f.push(b)}},$.updateColPositionCache=function(){g=[];for(var a=0;d>a;a++){var c=a*b;g.push(c)}},$.getNewTextCellContent=function(){return"<textarea></textarea>"},$.getNewTitleImageCellContent=function(){return'<input type="text"><div class="table__table__cell-add-image-controls"><a href="#" class="table__table__cell__add-image-button">Add image</a></div><div class="table__table__cell-remove-image-controls" style="display:none"></div>'},$.addNewTableRow=function(a){void 0===a&&(a="text");{var h=$.getTable();h.data("field_id")}h.css("height",$.getTableHeight()+c);var i=e+1,j=e*c;$.addRowActions(i),0===d&&(d=1,$.addColActions(1),g=[0]);for(var k=0;d>k;k++){var l=k+1,m="";switch(a){case"title_image":m=$.getNewTitleImageCellContent(i,l);break;case"text":m=$.getNewTextCellContent(i,l)}h.append('<div style="top:'+j+"px; left:"+k*b+'px" class="table__cell transitions" data-row-type="'+a+'" data-row="'+i+'" data-col="'+l+'">'+m+"</div>")}f.push(j),e++,$.getTableLeftBar().css("height",$.getTableHeight()+20+"px"),$.updateTableCells()};var a=$.getTable(),b=200,c=100,d=a.data("init-num-cols"),e=a.data("init-num-rows"),f=[0],g=[],h=!1,i=!1,j=!1,k=!1,l=!1;a.height($.getTableHeight());var m=0,n=0;$.addRowActions(1),$.getTableCells().each(function(){m>=d&&(m=0,n++,$.addRowActions(n+1),f.push(n*c)),$(this).css("left",m*b),$(this).css("top",n*c),0===n&&(g.push(m*b),$.addColActions(m+1)),m++}),$.getTableLeftBar().css("height",e*c+20+"px"),setTimeout($.addTransitionsClass,500),$(document).on("click",function(){$(".table__table__add-row-dropdown").is(":visible")&&$(".table__table__add-row-dropdown").hide()}),$(".table__table__add-row").on("click",function(a){a.preventDefault(),a.stopPropagation(),$(".table__table__add-row-dropdown").is(":visible")?$(".table__table__add-row-dropdown").hide():$(".table__table__add-row-dropdown").show()}),$(".table__table__add-text-row").on("click",function(a){a.preventDefault(),a.stopPropagation(),$(".table__table__add-row-dropdown").hide(),$.addNewTableRow()}),$(".table__table__add-title-image-row").on("click",function(a){a.preventDefault(),a.stopPropagation(),$(".table__table__add-row-dropdown").hide(),$.addNewTableRow("title_image")}),$(document).on("click",".table__table__cell__add-image-button",function(a){a.preventDefault();var b=$(this).parent(),c=$(this).parent().next(),d=new Assets.Sheet({multiSelect:!1,filedirs:"all",kinds:["image"],onSelect:function(a){if(a.length>0){b.hide();var d=a[0].id,e=Assets.siteUrl+"?ACT="+Assets.actions.view_thumbnail+"&file_id="+d+"&size=200x200&hash="+Math.random();c.prepend('<img src="'+e+'"/>'),c.fadeIn()}}});d.show()}),$(".table__table__add-col").on("click",function(a){if(a.preventDefault(),0===e)return void alert("Add a row first");$(".table__table__add-row-dropdown").hide();var f=$.getTable();f.css("width",$(".table__table").width()+b);var h=d+1,i=d*b;$.addColActions(h);for(var j=0;e>j;j++){var k=j+1,l=$('.table__table .table__cell[data-row="'+k+'"][data-col=1]').data("row-type"),m="";switch(l){case"title_image":m=$.getNewTitleImageCellContent(k,h);break;case"text":m=$.getNewTextCellContent(k,h)}f.append('<div style="top:'+j*c+"px; left:"+i+'px" class="table__cell transitions" data-row="'+k+'" data-col="'+h+'">'+m+"</div>")}g.push(i),d++,$.updateTableCells()}),$(document).on("click",".table__table__delete-row",function(){var a=$(this).data("row"),b=$.getTableRow(a),d=$.getTableRowDragger(a),f=$.getTableRowDeleteLink(a),g=$.getTable();if(b.addClass("table__cell-pending-delete"),confirm("Sure you want to delete the row?")){b.remove(),d.remove(),f.remove(),e--,g.css("height",c*e),$.updateRowPositionsCache();for(var h=a;e>=h;h++)$.updateTableRow(h+1,-1);$.getTableLeftBar().css("height",$.getTableHeight()+20+"px"),$.updateTableCells()}else b.removeClass("table__cell-pending-delete")}),$(document).on("click",".table__table__delete-col",function(){var c=$(this).data("col"),e=$.getTableCol(c),f=$.getTableColDragger(c),g=$.getTableColDeleteLink(c);if(e.addClass("table__cell-pending-delete"),confirm("Sure you want to delete the column?")){e.remove(),f.remove(),g.remove(),d--,a.css("width",b*d),$.updateColPositionCache();for(var h=c;d>=h;h++)$.updateTableCol(h+1,-1)}else e.removeClass("table__cell-pending-delete")}),$(document).on("mousedown",".drag-row",function(a){a.preventDefault(),a.stopPropagation(),$(this).addClass("active__dragging__link");var b=$(this).data("row"),c=$.getTableRow(b);return c.removeClass("transitions").addClass("table__dragging__element"),$.getTableRowDeleteLink().fadeOut(),$(".drag-row").not(".active__dragging__link").fadeOut(400,function(){h||$(this).show()}),h=!0,i=b,j=!1,!1}),$(document).on("mousedown",".drag-col",function(a){a.preventDefault(),a.stopPropagation(),$(this).addClass("active__dragging__link"),$.getTableColDeleteLink().fadeOut();var b=$(this).data("col");return $.getTableCol(b).removeClass("transitions").addClass("table__dragging__element"),$(".drag-col").not(".active__dragging__link").fadeOut(400,function(){h||$(this).show()}),h=!0,j=b,i=!1,!1}),$(document).on("mousemove",function(a){if(a.preventDefault(),h){var d=$.getTable();if(i){l=a.pageY-d.offset().top;var e=$(".drag-row.active__dragging__link");e.css("top",l+"px"),e.css("left","-20px"),e.css("position","absolute"),$(".table__dragging__element").each(function(){$(this).css("top",l+"px")});var m=$.closest(l,f),n=m.position+1;if(m.position+1>i){var o=m.position+1,p=m.closest-c;$.getTableRow(o).each(function(){$(this).css("top",p+"px"),$(this).attr("data-row",o-1),$(this).data("row",o-1)}),$(".table__dragging__element").each(function(){$(this).attr("data-row",n+1),$(this).data("row",n+1)}),i=n+1}else if(m.position+1<i){var q=m.position+1,r=q*c;$.getTableRow(q).each(function(){$(this).css("top",r+"px"),$(this).attr("data-row",q+1),$(this).data("row",q+1)}),$(".table__dragging__element").each(function(){$(this).attr("data-row",n),$(this).data("row",n)}),i=n}}else if(j){k=a.pageX-d.offset().left-b;var s=$(".drag-col.active__dragging__link");s.css("top","-20px"),s.css("left",k+b-19+"px"),s.css("position","absolute"),$(".table__dragging__element").each(function(){$(this).css("left",k+"px")});var t=$.closest(k,g),u=t.position+1;if(u>j){var v=(t.position-1)*b;$.getTableCol(u).each(function(){$(this).css("left",v+"px"),$(this).attr("data-col",u-1),$(this).data("col",u-1)}),$(".table__dragging__element").each(function(){$(this).attr("data-col",u),$(this).data("col",u)}),j=u}else if(j>u){var w=(t.position+1)*b;$.getTableCol(u).each(function(){$(this).css("left",w+"px"),$(this).attr("data-col",u+1),$(this).data("col",u+1)}),$(".table__dragging__element").each(function(){$(this).attr("data-col",u),$(this).data("col",u)}),j=u}}}return!1}),$(document).on("mouseup",function(a){if(a.preventDefault(),h=!1,$(".active__dragging__link").removeClass("active__dragging__link"),i){$.getTableRowDeleteLink().fadeIn();var d=$.closest(l,f),e=d.closest;$(".table__dragging__element").css("top",e+"px");var m=1;$.getTableRowDragger().each(function(){$(this).css("top",(m-1)*c+"px"),$(this).attr("data-row",m),$(this).data("row",m),m++,$(this).show()})}else if(j){$.getTableColDeleteLink().fadeIn();var n=$.closest(k,g),o=n.closest;$(".table__dragging__element").css("left",o+"px");var p=1;$.getTableColDragger().each(function(){$(this).css("left",p*b-19+"px"),$(this).attr("data-col",p),$(this).data("col",p),console.log("showing col "+p),p++,$(this).show()})}return $.getTableCells().removeClass("table__dragging__element").addClass("transitions"),$.updateTableCells(),i=!1,j=!1,!1})});
//# sourceMappingURL=table.min.map