var Table;!function(a,b){var c=function(a,b,c){var d;return function(){function e(){c||a.apply(f,g),d=null}var f=this,g=arguments;d?clearTimeout(d):c&&a.apply(f,g),d=setTimeout(e,b||100)}};jQuery.fn[b]=function(a){return a?this.bind("resize",c(a)):this.trigger(b)}}(jQuery,"smartresize"),function(a){Table=function(b,c,d,e){var f=a(this),g=a("#table__table__"+b);f.closest=function(b,c){var d=null,e=-1;return a.each(c,function(){(null===d||Math.abs(this-b)<Math.abs(d-b))&&(d=this,e++)}),{position:e,closest:d}},f.updateFieldContainerWidth=function(){a(".table__table__container").width(a("#publish").width()-36)},f.addRowActions=function(a){g.append('<div class="drag-row icon-reorder" style="top:'+(a-1)*i+'px" data-row="'+a+'"></div>'),g.append('<div class="table__table__delete-row icon-remove-circle" style="top: '+(a*i-i/2-5)+'px" data-row="'+a+'"></div>')},f.addColActions=function(a){g.append('<div class="drag-col icon-reorder" style="left:'+(a*h-19)+'px" data-col="'+a+'"></div>'),g.append('<div class="table__table__delete-col icon-remove-circle" style="left: '+(a*h-h/2-8+'px" data-col="'+a+'"></div>'))},f.addTransitionsClass=function(){a("#table__table__"+b+" .table__cell").addClass("transitions")},f.getTableHeight=function(){return k*i},f.getTableWidth=function(){return j*h},f.updateTableCells=function(){for(var e=200*c,f=e,g=1;k+1>g;g++)for(var h=1;j+1>h;h++){f++;var i=a("#table__table__"+b+' .table__cell[data-row="'+g+'"][data-col="'+h+'"]'),l=i.data("row-type"),m="table_cell_"+b+"["+g+"]["+h+"]["+l+"]",n=0!==i.data("inited");if(!n){var o=i.data("init-cell-value"),p=d.getNewCellContent(l,b,g,h,o);i.attr("inited",1),i.data("inited",1),i.html(p)}d.updateCellContent(l,g,h,f,m,i)}},f.getTable=function(){return a("#table__table__"+b)},f.getTableLeftBar=function(){return a("#table__table__"+b+" .table__table__left__bar")},f.getTableCells=function(){return a("#table__table__"+b+" .table__cell")},f.getTableCol=function(c){return a("#table__table__"+b+" .table__cell[data-col="+c+"]")},f.getTableRow=function(c){return a("#table__table__"+b+' .table__cell[data-row="'+c+'"]')},f.getTableRowDragger=function(c){return a(void 0!==c?"#table__table__"+b+' .drag-row[data-row="'+c+'"]':"#table__table__"+b+" .drag-row")},f.getTableColDragger=function(c){return a(void 0!==c?"#table__table__"+b+' .drag-col[data-col="'+c+'"]':"#table__table__"+b+" .drag-col")},f.getTableRowDeleteLink=function(c){return a(void 0!==c?"#table__table__"+b+' .table__table__delete-row[data-row="'+c+'"]':"#table__table__"+b+" .table__table__delete-row")},f.getTableColDeleteLink=function(c){return a(void 0!==c?"#table__table__"+b+' .table__table__delete-col[data-col="'+c+'"]':"#table__table__"+b+" .table__table__delete-col")},f.updateTableRow=function(a,b){var c=a,d=f.getTableRow(a),e=f.getTableRowDragger(a),g=f.getTableRowDeleteLink(a);void 0!==b&&(c=a+b,d.data("row",c),d.attr("data-row",c),e.data("row",c),e.attr("data-row",c),g.data("row",c),g.attr("data-row",c));var h=l[c-1];e.css("top",h+"px"),d.css("top",h+"px"),g.css("top",h+i/2-5+"px")},f.updateTableCol=function(a,b){var c=a,d=f.getTableCol(a),e=f.getTableColDragger(a),g=f.getTableColDeleteLink(a);void 0!==b&&(c=a+b,d.data("col",c),d.attr("data-col",c),e.data("col",c),e.attr("data-col",c),g.data("col",c),g.attr("data-col",c));var i=m[c-1];d.css("left",i+"px"),e.css("left",i-19+"px"),g.css("left",i+(h/2-8)+"px")},f.updateRowPositionsCache=function(){l=[];for(var a=0;k>a;a++){var b=a*i;l.push(b)}},f.updateColPositionCache=function(){m=[];for(var a=0;j>a;a++){var b=a*h;m.push(b)}},f.addNewTableRow=function(a){g.css("height",f.getTableHeight()+i);var c=k+1,e=k*i;f.addRowActions(c),0===j&&(j=1,f.addColActions(1),m=[0]);for(var n=0;j>n;n++){var o=n+1,p="";p=d.getNewCellContent(a,b,c,o),g.append('<div style="top:'+e+"px; left:"+n*h+'px" class="table__cell transitions" data-row-type="'+a+'" data-row="'+c+'" data-col="'+o+'">'+p+"</div>")}l.push(e),k++,f.getTableLeftBar().css("height",f.getTableHeight()+20+"px"),f.updateTableCells()};var h=200,i=150,j=g.data("init-num-cols"),k=g.data("init-num-rows"),l=[0],m=[],n=!1,o=!1,p=!1,q=!1,r=!1;g.height(f.getTableHeight()),j>0&&g.width(f.getTableWidth());var s=0,t=0;k>0&&f.addRowActions(1),f.getTableCells().each(function(){s>=j&&(s=0,t++,f.addRowActions(t+1),l.push(t*i)),a(this).css("left",s*h),a(this).css("top",t*i),0===t&&(m.push(s*h),f.addColActions(s+1)),s++}),f.getTableLeftBar().css("height",k*i+20+"px"),f.updateTableCells(),setTimeout(f.addTransitionsClass,500),a(document).on("click",".table__table__add-row[data-field_id="+b+"]",function(c){c.preventDefault(),c.stopPropagation();var d=a(".table__table__add-row-dropdown[data-field_id="+b+"]");0===d.length?f.addNewTableRow("text"):d.is(":visible")?d.hide():d.show()}),a(".table__table__add-row-dropdown[data-field_id="+b+"] .table__table__add-row").on("click",function(c){c.preventDefault(),c.stopPropagation();var d=a(this).data("celltype");a(".table__table__add-row-dropdown[data-field_id="+b+"]").hide(),f.addNewTableRow(d)}),a(document).on("click",".table__table__cell__add-image-button[data-field_id="+b+"]",function(b){b.preventDefault();var c=a(this).parent(),f=c.parent().find(".table__table__cell-thumbnail"),g=c.parent().find(".table__table__cell-remove-image-controls");if(e){var h=new Assets.Sheet({multiSelect:!1,filedirs:"all",kinds:["image"],onSelect:function(a){if(a.length>0){c.hide();var b=a[0].id,e=d.getAssetsImgThumb(b);f.html(e),g.fadeIn()}}});h.show()}else{var i=a(this).data("has_ee_file_trigger");i||(a.ee_filebrowser.add_trigger(a(this),"field_name_changeme",function(a){c.hide();var b=a.file_id,d='<img data-file_id="'+b+'" src="'+a.thumb+'"/>';f.html(d),g.fadeIn()}),a(this).click())}}),a(document).on("click",".table__table__cell__remove-image-button[data-field_id="+b+"]",function(b){b.preventDefault();var c=a(this).parent(),d=c.parent().find(".table__table__cell-add-image-controls"),e=c.find(".table__table__cell-thumbnail");e.html(""),c.hide(),d.fadeIn(),f.updateTableCells()}),a(".table__table__add-col[data-field_id="+b+"]").on("click",function(c){if(c.preventDefault(),0===k){var e=a(".table__table__add-row-dropdown[data-field_id="+b+"]");return void(e.length>0?a.ee_notice("Please add a row first.",{open:!0}):f.addNewTableRow("text"))}a("#table__table__"+b+" .table__table__add-row-dropdown[data-field_id="+b+"]").hide(),g.css("width",f.getTableWidth()+h);var l=j+1,n=j*h;f.addColActions(l);for(var o=0;k>o;o++){var p=o+1,q=a("#table__table__"+b+' .table__cell[data-row="'+p+'"][data-col=1]').data("row-type"),r=d.getNewCellContent(q,b,p,l);g.append('<div style="top:'+o*i+"px; left:"+n+'px" class="table__cell transitions" data-row-type="'+q+'" data-row="'+p+'" data-col="'+l+'">'+r+"</div>")}m.push(n),j++,f.updateTableCells()}),a(document).on("click","#table__table__"+b+" .table__table__delete-row",function(){var b=a(this).data("row"),c=f.getTableRow(b),d=f.getTableRowDragger(b),e=f.getTableRowDeleteLink(b);if(c.addClass("table__cell-pending-delete"),confirm("Sure you want to delete the row?")){c.remove(),d.remove(),e.remove(),k--,g.css("height",i*k),f.updateRowPositionsCache();for(var h=b;k>=h;h++)f.updateTableRow(h+1,-1);f.getTableLeftBar().css("height",f.getTableHeight()+20+"px"),f.updateTableCells()}else c.removeClass("table__cell-pending-delete")}),a(document).on("click","#table__table__"+b+" .table__table__delete-col",function(){var b=a(this).data("col"),c=f.getTableCol(b),d=f.getTableColDragger(b),e=f.getTableColDeleteLink(b);if(c.addClass("table__cell-pending-delete"),confirm("Sure you want to delete the column?")){c.remove(),d.remove(),e.remove(),j--,g.css("width",h*j),f.updateColPositionCache();for(var i=b;j>=i;i++)f.updateTableCol(i+1,-1)}else c.removeClass("table__cell-pending-delete")}),a(document).on("mousedown","#table__table__"+b+" .drag-row",function(c){c.preventDefault(),c.stopPropagation(),a(this).addClass("active__dragging__link");var d=a(this).data("row"),e=f.getTableRow(d);return e.removeClass("transitions").addClass("table__dragging__element"),f.getTableRowDeleteLink().fadeOut(),a("#table__table__"+b+" .drag-row").not(".active__dragging__link").fadeOut(400,function(){n||a(this).show()}),n=!0,o=d,p=!1,!1}),a(document).on("mousedown","#table__table__"+b+" .drag-col",function(c){c.preventDefault(),c.stopPropagation(),a(this).addClass("active__dragging__link"),f.getTableColDeleteLink().fadeOut();var d=a(this).data("col");return f.getTableCol(d).removeClass("transitions").addClass("table__dragging__element"),a("#table__table__"+b+" .drag-col").not(".active__dragging__link").fadeOut(400,function(){n||a(this).show()}),n=!0,p=d,o=!1,!1}),a(document).on("mousemove",function(c){if(c.preventDefault(),n)if(o){r=c.pageY-g.offset().top;var d=a(".drag-row.active__dragging__link");d.css("top",r+"px"),d.css("left","-20px"),d.css("position","absolute"),a("#table__table__"+b+" .table__dragging__element").each(function(){a(this).css("top",r+"px")});var e=f.closest(r,l),j=e.position+1;if(e.position+1>o){var k=e.position+1,s=e.closest-i;f.getTableRow(k).each(function(){a(this).css("top",s+"px"),a(this).attr("data-row",k-1),a(this).data("row",k-1)}),a("#table__table__"+b+" .table__dragging__element").each(function(){a(this).attr("data-row",j+1),a(this).data("row",j+1)}),o=j+1}else if(e.position+1<o){var t=e.position+1,u=t*i;f.getTableRow(t).each(function(){a(this).css("top",u+"px"),a(this).attr("data-row",t+1),a(this).data("row",t+1)}),a("#table__table__"+b+" .table__dragging__element").each(function(){a(this).attr("data-row",j),a(this).data("row",j)}),o=j}}else if(p){q=c.pageX-g.offset().left-h;var v=a(".drag-col.active__dragging__link");v.css("top","-20px"),v.css("left",q+h-19+"px"),v.css("position","absolute"),a("#table__table__"+b+" .table__dragging__element").each(function(){a(this).css("left",q+"px")});var w=f.closest(q,m),x=w.position+1;if(x>p){var y=(w.position-1)*h;f.getTableCol(x).each(function(){a(this).css("left",y+"px"),a(this).attr("data-col",x-1),a(this).data("col",x-1)}),a("#table__table__"+b+" .table__dragging__element").each(function(){a(this).attr("data-col",x),a(this).data("col",x)}),p=x}else if(p>x){var z=(w.position+1)*h;f.getTableCol(x).each(function(){a(this).css("left",z+"px"),a(this).attr("data-col",x+1),a(this).data("col",x+1)}),a("#table__table__"+b+" .table__dragging__element").each(function(){a(this).attr("data-col",x),a(this).data("col",x)}),p=x}}return!1}),a(document).on("mouseup",function(b){if(b.preventDefault(),n=!1,a(".active__dragging__link").removeClass("active__dragging__link"),o){f.getTableRowDeleteLink().fadeIn();var c=f.closest(r,l),d=c.closest;a(".table__dragging__element").css("top",d+"px");var e=1;f.getTableRowDragger().each(function(){a(this).css("top",(e-1)*i+"px"),a(this).attr("data-row",e),a(this).data("row",e),e++,a(this).show()})}else if(p){f.getTableColDeleteLink().fadeIn();var g=f.closest(q,m),j=g.closest;a(".table__dragging__element").css("left",j+"px");var k=1;f.getTableColDragger().each(function(){a(this).css("left",k*h-19+"px"),a(this).attr("data-col",k),a(this).data("col",k),k++,a(this).show()})}return f.getTableCells().removeClass("table__dragging__element").addClass("transitions"),f.updateTableCells(),o=!1,p=!1,!1}),f.updateFieldContainerWidth(),a(window).smartresize(f.updateFieldContainerWidth)}}(jQuery);
//# sourceMappingURL=table.min.map