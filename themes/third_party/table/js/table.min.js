var Table;!function(a,b){var c=function(a,b,c){var d;return function(){function e(){c||a.apply(f,g),d=null}var f=this,g=arguments;d?clearTimeout(d):c&&a.apply(f,g),d=setTimeout(e,b||100)}};jQuery.fn[b]=function(a){return a?this.bind("resize",c(a)):this.trigger(b)}}(jQuery,"smartresize"),function(a){console.log("Creating Table"),Table=function(b,c){var d=a(this),e=a("#table__table__"+b);d.closest=function(b,c){var d=null,e=-1;return a.each(c,function(){(null===d||Math.abs(this-b)<Math.abs(d-b))&&(d=this,e++)}),{position:e,closest:d}},d.updateFieldContainerWidth=function(){a(".table__table__container").width(a("#publish").width()-36)},d.addRowActions=function(a){e.append('<div class="drag-row icon-reorder" style="top:'+(a-1)*g+'px" data-row="'+a+'"></div>'),e.append('<div class="table__table__delete-row icon-remove-circle" style="top: '+(a*g-g/2-5)+'px" data-row="'+a+'"></div>')},d.addColActions=function(a){e.append('<div class="drag-col icon-reorder" style="left:'+(a*f-19)+'px" data-col="'+a+'"></div>'),e.append('<div class="table__table__delete-col icon-remove-circle" style="left: '+(a*f-f/2-8+'px" data-col="'+a+'"></div>'))},d.addTransitionsClass=function(){a("#table__table__"+b+" .table__cell").addClass("transitions")},d.getTableHeight=function(){return i*g},d.getTableWidth=function(){return h*f},d.updateTitleImageCellData=function(c,d,e,f){void 0===e&&(e="table_cell_"+b+"["+c+"]["+d+"]"),"undefined"==typeof f&&(f=a("#table__table__"+b+' .table__cell[data-row="'+c+'"][data-col="'+d+'"]'));var g=f.find("input[type=hidden]");g.attr("name",e);var h=f.find("img").data("assets_file_id"),i=f.find("input[type=text]").val();g.val(JSON.stringify({assets_file_id:h,title_text:i}))},d.updateTableCells=function(){for(var e=0,f=1;i+1>f;f++)for(var g=1;h+1>g;g++){e++;var j=a("#table__table__"+b+' .table__cell[data-row="'+f+'"][data-col="'+g+'"]'),k=j.data("row-type"),l="table_cell_"+b+"["+f+"]["+g+"]["+k+"]",m=0!==j.data("inited");switch(k){case"text":if(!m){var n=j.data("init-cell-value"),o=c.getNewCellContent(k,b,f,g,{text:n});j.attr("inited",1),j.data("inited",1),j.html(o)}var p=j.children().first();p.attr("tabindex",e),p.attr("name",l);break;case"title_image":if(!m){var q=j.data("init-cell-value"),r=c.getNewCellContent(k,b,f,g,q);j.attr("inited",1),j.data("inited",1),j.html(r)}d.updateTitleImageCellData(f,g,l,j)}}},d.getTable=function(){return a("#table__table__"+b)},d.getTableLeftBar=function(){return a("#table__table__"+b+" .table__table__left__bar")},d.getTableCells=function(){return a("#table__table__"+b+" .table__cell")},d.getTableCol=function(c){return a("#table__table__"+b+" .table__cell[data-col="+c+"]")},d.getTableRow=function(c){return a("#table__table__"+b+' .table__cell[data-row="'+c+'"]')},d.getTableRowDragger=function(c){return a(void 0!==c?"#table__table__"+b+' .drag-row[data-row="'+c+'"]':"#table__table__"+b+" .drag-row")},d.getTableColDragger=function(c){return a(void 0!==c?"#table__table__"+b+' .drag-col[data-col="'+c+'"]':"#table__table__"+b+" .drag-col")},d.getTableRowDeleteLink=function(c){return a(void 0!==c?"#table__table__"+b+' .table__table__delete-row[data-row="'+c+'"]':"#table__table__"+b+" .table__table__delete-row")},d.getTableColDeleteLink=function(c){return a(void 0!==c?"#table__table__"+b+' .table__table__delete-col[data-col="'+c+'"]':"#table__table__"+b+" .table__table__delete-col")},d.updateTableRow=function(a,b){var c=a,e=d.getTableRow(a),f=d.getTableRowDragger(a),h=d.getTableRowDeleteLink(a);void 0!==b&&(c=a+b,e.data("row",c),e.attr("data-row",c),f.data("row",c),f.attr("data-row",c),h.data("row",c),h.attr("data-row",c));var i=j[c-1];f.css("top",i+"px"),e.css("top",i+"px"),h.css("top",i+g/2-5+"px")},d.updateTableCol=function(a,b){var c=a,e=d.getTableCol(a),g=d.getTableColDragger(a),h=d.getTableColDeleteLink(a);void 0!==b&&(c=a+b,e.data("col",c),e.attr("data-col",c),g.data("col",c),g.attr("data-col",c),h.data("col",c),h.attr("data-col",c));var i=k[c-1];e.css("left",i+"px"),g.css("left",i-19+"px"),h.css("left",i+(f/2-8)+"px")},d.updateRowPositionsCache=function(){j=[];for(var a=0;i>a;a++){var b=a*g;j.push(b)}},d.updateColPositionCache=function(){k=[];for(var a=0;h>a;a++){var b=a*f;k.push(b)}},d.addNewTableRow=function(a){void 0===a&&(a="text"),e.css("height",d.getTableHeight()+g);var l=i+1,m=i*g;d.addRowActions(l),0===h&&(h=1,d.addColActions(1),k=[0]);for(var n=0;h>n;n++){var o=n+1,p="";p=c.getNewCellContent(a,b,l,o),e.append('<div style="top:'+m+"px; left:"+n*f+'px" class="table__cell transitions" data-row-type="'+a+'" data-row="'+l+'" data-col="'+o+'">'+p+"</div>")}j.push(m),i++,d.getTableLeftBar().css("height",d.getTableHeight()+20+"px"),d.updateTableCells()};var f=200,g=150,h=e.data("init-num-cols"),i=e.data("init-num-rows"),j=[0],k=[],l=!1,m=!1,n=!1,o=!1,p=!1;e.height(d.getTableHeight()),h>0&&e.width(d.getTableWidth());var q=0,r=0;i>0&&d.addRowActions(1),d.getTableCells().each(function(){q>=h&&(q=0,r++,d.addRowActions(r+1),j.push(r*g)),a(this).css("left",q*f),a(this).css("top",r*g),0===r&&(k.push(q*f),d.addColActions(q+1)),q++}),d.getTableLeftBar().css("height",i*g+20+"px"),d.updateTableCells(),setTimeout(d.addTransitionsClass,500),a(".table__table__add-row[data-field_id="+b+"]").on("click",function(c){c.preventDefault(),c.stopPropagation();var d=a(".table__table__add-row-dropdown[data-field_id="+b+"]");d.is(":visible")?d.hide():d.show()}),a(".table__table__add-row-dropdown[data-field_id="+b+"] .table__table__add-text-row").on("click",function(c){c.preventDefault(),c.stopPropagation(),a(".table__table__add-row-dropdown[data-field_id="+b+"]").hide(),d.addNewTableRow()}),a(".table__table__add-row-dropdown[data-field_id="+b+"] .table__table__add-title-image-row").on("click",function(c){c.preventDefault(),c.stopPropagation(),a(".table__table__add-row-dropdown[data-field_id="+b+"]").hide(),d.addNewTableRow("title_image")}),a(document).on("click",".table__table__cell__add-image-button[data-field_id="+b+"]",function(b){b.preventDefault();var d=a(this).parent(),e=d.parent().find(".table__table__cell-thumbnail"),f=d.parent().find(".table__table__cell-remove-image-controls"),g=new Assets.Sheet({multiSelect:!1,filedirs:"all",kinds:["image"],onSelect:function(a){if(a.length>0){d.hide();var b=a[0].id,g=c.getAssetsImgThumb(b);e.html(g),f.fadeIn()}}});g.show()}),a(document).on("click",".table__table__cell__remove-image-button[data-field_id="+b+"]",function(b){b.preventDefault();var c=a(this).parent(),d=c.parent().find(".table__table__cell-add-image-controls"),e=c.find(".table__table__cell-thumbnail");e.html(""),c.hide(),d.fadeIn()}),a(".table__table__add-col[data-field_id="+b+"]").on("click",function(j){if(j.preventDefault(),0===i)return void alert("Add a row first");a("#table__table__"+b+" .table__table__add-row-dropdown[data-field_id="+b+"]").hide(),e.css("width",d.getTableWidth()+f);var l=h+1,m=h*f;d.addColActions(l);for(var n=0;i>n;n++){var o=n+1,p=a("#table__table__"+b+' .table__cell[data-row="'+o+'"][data-col=1]').data("row-type"),q=c.getNewCellContent(p,b,o,l);e.append('<div style="top:'+n*g+"px; left:"+m+'px" class="table__cell transitions" data-row-type="'+p+'" data-row="'+o+'" data-col="'+l+'">'+q+"</div>")}k.push(m),h++,d.updateTableCells()}),a(document).on("click","#table__table__"+b+" .table__table__delete-row",function(){var b=a(this).data("row"),c=d.getTableRow(b),f=d.getTableRowDragger(b),h=d.getTableRowDeleteLink(b);if(c.addClass("table__cell-pending-delete"),confirm("Sure you want to delete the row?")){c.remove(),f.remove(),h.remove(),i--,e.css("height",g*i),d.updateRowPositionsCache();for(var j=b;i>=j;j++)d.updateTableRow(j+1,-1);d.getTableLeftBar().css("height",d.getTableHeight()+20+"px"),d.updateTableCells()}else c.removeClass("table__cell-pending-delete")}),a(document).on("click","#table__table__"+b+" .table__table__delete-col",function(){var b=a(this).data("col"),c=d.getTableCol(b),g=d.getTableColDragger(b),i=d.getTableColDeleteLink(b);if(c.addClass("table__cell-pending-delete"),confirm("Sure you want to delete the column?")){c.remove(),g.remove(),i.remove(),h--,e.css("width",f*h),d.updateColPositionCache();for(var j=b;h>=j;j++)d.updateTableCol(j+1,-1)}else c.removeClass("table__cell-pending-delete")}),a(document).on("mousedown","#table__table__"+b+" .drag-row",function(c){c.preventDefault(),c.stopPropagation(),a(this).addClass("active__dragging__link");var e=a(this).data("row"),f=d.getTableRow(e);return f.removeClass("transitions").addClass("table__dragging__element"),d.getTableRowDeleteLink().fadeOut(),a("#table__table__"+b+" .drag-row").not(".active__dragging__link").fadeOut(400,function(){l||a(this).show()}),l=!0,m=e,n=!1,!1}),a(document).on("mousedown","#table__table__"+b+" .drag-col",function(c){c.preventDefault(),c.stopPropagation(),a(this).addClass("active__dragging__link"),d.getTableColDeleteLink().fadeOut();var e=a(this).data("col");return d.getTableCol(e).removeClass("transitions").addClass("table__dragging__element"),a("#table__table__"+b+" .drag-col").not(".active__dragging__link").fadeOut(400,function(){l||a(this).show()}),l=!0,n=e,m=!1,!1}),a(document).on("mousemove",function(c){if(c.preventDefault(),l)if(m){p=c.pageY-e.offset().top;var h=a(".drag-row.active__dragging__link");h.css("top",p+"px"),h.css("left","-20px"),h.css("position","absolute"),a("#table__table__"+b+" .table__dragging__element").each(function(){a(this).css("top",p+"px")});var i=d.closest(p,j),q=i.position+1;if(i.position+1>m){var r=i.position+1,s=i.closest-g;d.getTableRow(r).each(function(){a(this).css("top",s+"px"),a(this).attr("data-row",r-1),a(this).data("row",r-1)}),a("#table__table__"+b+" .table__dragging__element").each(function(){a(this).attr("data-row",q+1),a(this).data("row",q+1)}),m=q+1}else if(i.position+1<m){var t=i.position+1,u=t*g;d.getTableRow(t).each(function(){a(this).css("top",u+"px"),a(this).attr("data-row",t+1),a(this).data("row",t+1)}),a("#table__table__"+b+" .table__dragging__element").each(function(){a(this).attr("data-row",q),a(this).data("row",q)}),m=q}}else if(n){o=c.pageX-e.offset().left-f;var v=a(".drag-col.active__dragging__link");v.css("top","-20px"),v.css("left",o+f-19+"px"),v.css("position","absolute"),a("#table__table__"+b+" .table__dragging__element").each(function(){a(this).css("left",o+"px")});var w=d.closest(o,k),x=w.position+1;if(x>n){var y=(w.position-1)*f;d.getTableCol(x).each(function(){a(this).css("left",y+"px"),a(this).attr("data-col",x-1),a(this).data("col",x-1)}),a("#table__table__"+b+" .table__dragging__element").each(function(){a(this).attr("data-col",x),a(this).data("col",x)}),n=x}else if(n>x){var z=(w.position+1)*f;d.getTableCol(x).each(function(){a(this).css("left",z+"px"),a(this).attr("data-col",x+1),a(this).data("col",x+1)}),a("#table__table__"+b+" .table__dragging__element").each(function(){a(this).attr("data-col",x),a(this).data("col",x)}),n=x}}return!1}),a(document).on("mouseup",function(b){if(b.preventDefault(),l=!1,a(".active__dragging__link").removeClass("active__dragging__link"),m){d.getTableRowDeleteLink().fadeIn();var c=d.closest(p,j),e=c.closest;a(".table__dragging__element").css("top",e+"px");var h=1;d.getTableRowDragger().each(function(){a(this).css("top",(h-1)*g+"px"),a(this).attr("data-row",h),a(this).data("row",h),h++,a(this).show()})}else if(n){d.getTableColDeleteLink().fadeIn();var i=d.closest(o,k),q=i.closest;a(".table__dragging__element").css("left",q+"px");var r=1;d.getTableColDragger().each(function(){a(this).css("left",r*f-19+"px"),a(this).attr("data-col",r),a(this).data("col",r),r++,a(this).show()})}return d.getTableCells().removeClass("table__dragging__element").addClass("transitions"),d.updateTableCells(),m=!1,n=!1,!1}),d.updateFieldContainerWidth(),a(window).smartresize(d.updateFieldContainerWidth)}}(jQuery);
//# sourceMappingURL=table.min.map